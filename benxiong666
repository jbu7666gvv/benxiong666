-- ç¯å¢ƒæ£€æŸ¥å’Œå®‰å…¨å‡½æ•°å®šä¹‰
local function safeRequire(func, fallback)
    local success, result = pcall(func)
    return success and result or fallback
end

-- ç¼“å­˜å¸¸ç”¨å‡½æ•°
local task_wait = task.wait
local collectgarbage_collect = collectgarbage
local loadstring = loadstring or load

-- å®‰å…¨çš„ HTTP è·å–
local function httpGet(url)
    local success, result = pcall(function()
        if game.HttpGet then
            return game:HttpGet(url, true)
        elseif syn and syn.request then
            local response = syn.request({Url = url, Method = "GET"})
            return response.Body
        elseif request then
            local response = request({Url = url, Method = "GET"})
            return response.Body
        else
            error("æ²¡æœ‰å¯ç”¨çš„ HTTP æ–¹æ³•")
        end
    end)
    return success and result or nil
end

-- å®‰å…¨çš„å‰ªè´´æ¿æ“ä½œ
local function safeSetClipboard(text)
    local success, err = pcall(function()
        if setclipboard then
            setclipboard(text)
        elseif syn and syn.write_clipboard then
            syn.write_clipboard(text)
        elseif write_clipboard then
            write_clipboard(text)
        else
            error("æ²¡æœ‰å¯ç”¨çš„å‰ªè´´æ¿æ–¹æ³•")
        end
    end)
    return success
end

-- é¢œè‰²å¸¸é‡
local COLORS = {
    GRADIENT_START = Color3.fromHex("#00FF87"),
    GRADIENT_END = Color3.fromHex("#60EFFF"),
    BUTTON_START = Color3.fromHex("#FF0F7B"),
    BUTTON_END = Color3.fromHex("#F89B29")
}

-- å›¾æ ‡å¸¸é‡
local KEY_ICON = " ğŸ”‘"
local CHECK_ICON = " âœ…"

-- å®‰å…¨è°ƒç”¨å‡½æ•°
local function safeCall(func, errorMessage)
    local success, err = pcall(func)
    if not success then
        if WindUI then
            WindUI:Notify({Title = "é”™è¯¯", Content = errorMessage .. ": " .. tostring(err), Duration = 5})
        end
    end
    return success
end

-- åŠ è½½ WindUI åº“
local WindUISuccess, WindUI = pcall(function()
    local windUISource = httpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua")
    if windUISource then
        return loadstring(windUISource)()
    else
        error("æ— æ³•åŠ è½½ WindUI åº“")
    end
end)

if not WindUISuccess then
    warn("WindUI åŠ è½½å¤±è´¥: " .. tostring(WindUI))
    return
end

function gradient(text, startColor, endColor)
    local result = {}
    local length = #text
    
    for i = 1, length do
        local t = (i - 1) / math.max(length - 1, 1)
        local r = math.floor((startColor.R + (endColor.R - startColor.R) * t) * 255)
        local g = math.floor((startColor.G + (endColor.G - startColor.G) * t) * 255)
        local b = math.floor((startColor.B + (endColor.B - startColor.B) * t) * 255)
        
        table.insert(result, string.format('<font color="rgb(%d,%d,%d)">%s</font>', r, g, b, text:sub(i, i)))
    end
    
    return table.concat(result)
end

local function loadScript(url, scriptName)
    WindUI:Notify({Title = "æç¤º", Content = "æ­£åœ¨åŠ è½½ " .. scriptName .. "...", Duration = 2})
    
    local success, result = pcall(function()
        local response = httpGet(url)
        if not response or #response < 50 then
            return false, "è„šæœ¬å†…å®¹æ— æ•ˆæˆ–ä¸ºç©º"
        end
        
        local loadedFunction, loadError = loadstring(response)
        if not loadedFunction then
            return false, "è„šæœ¬ç¼–è¯‘é”™è¯¯: " .. tostring(loadError)
        end
        
        local executeSuccess, executeError = pcall(loadedFunction)
        if not executeSuccess then
            return false, "è„šæœ¬æ‰§è¡Œé”™è¯¯: " .. tostring(executeError)
        end
        
        return true
    end)
    
    if success and result then
        WindUI:Notify({Title = "æˆåŠŸ", Content = scriptName .. " åŠ è½½å®Œæˆ", Duration = 3})
    else
        local errorMsg = success and result or "ç½‘ç»œè¯·æ±‚å¤±è´¥"
        WindUI:Notify({Title = "é”™è¯¯", Content = scriptName .. " åŠ è½½å¤±è´¥: " .. errorMsg, Duration = 5})
    end
end

local Confirmed = false

WindUI:Popup({
    Title = "æ¬¢è¿ä½¿ç”¨æœ¬ç†Šæ±‰åŒ–",
    Icon = "rbxassetid://112682688917044",
    IconThemed = true,
    Content = "æœ¬ç†Šæ±‰åŒ–" .. gradient("WindUI", COLORS.GRADIENT_START, COLORS.GRADIENT_END) .. " Lib",  
    Buttons = {
        {
            Title = "é€€å‡º",
            Callback = function() 
                WindUI:Notify({Title = "æç¤º", Content = "å·²é€€å‡º", Duration = 2})
            end,
            Variant = "Secondary",
        },
        {
            Title = "ä½¿ç”¨",
            Icon = "arrow-right",
            Callback = function() 
                Confirmed = true 
                WindUI:Notify({Title = "æ¬¢è¿", Content = "å¼€å§‹ä½¿ç”¨æœ¬ç†Šæ±‰åŒ–", Duration = 2})
            end,
            Variant = "Primary",
        }
    }
})

repeat task_wait() until Confirmed

local Window = WindUI:CreateWindow({
    Title = "æœ¬ç†Šæ±‰åŒ–",
    Icon = "rbxassetid://129260712070622",
    IconThemed = true,
    Author = "æœ¬ç†Šæ±‰åŒ–",
    Folder = "æœ¬ç†Šæ±‰åŒ–",
    Size = UDim2.fromOffset(580, 460),
    Transparent = true,
    Theme = "Dark",
    User = {
        Enabled = true,
        Callback = function() 
            if safeSetClipboard("æœ¬ç†Šæ±‰åŒ–") then
                WindUI:Notify({Title = "æç¤º", Content = "å·²å¤åˆ¶ä½œè€…ä¿¡æ¯", Duration = 2})
            else
                WindUI:Notify({Title = "é”™è¯¯", Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", Duration = 2})
            end
        end,
        Anonymous = true
    },
    SideBarWidth = 200,
    ScrollBarEnabled = true,
    KeySystem = {
        Key = { "ç§‹å®¹" },
        Note = "è°æ²¡ç›®è¿˜çˆ±åœˆé’±ï¼Ÿ",
        URL = "ç§‹å®¹",
        SaveKey = true,
    }
})

Window:CreateTopbarButton("å…¨å±", "battery-plus", function() 
    Window:ToggleFullscreen()
    WindUI:Notify({Title = "æç¤º", Content = "åˆ‡æ¢å…¨å±æ¨¡å¼", Duration = 2})
end, 989)

Window:EditOpenButton({
    Title = "æœ¬ç†Šæ±‰åŒ–",
    Icon = "monitor",
    CornerRadius = UDim.new(0,16),
    StrokeThickness = 2,
    Color = ColorSequence.new(COLORS.BUTTON_START, COLORS.BUTTON_END),
    Draggable = true,
})

local Tabs = {
    Home = Window:Tab({ Title = "ä¸»é¡µ", Icon = "crown" }),
    Main = Window:Tab({ Title = "99å¤œ", Icon = "zap" }),
    Ninja = Window:Tab({ Title = "æ­»é“è½¨", Icon = "user" }),
    Oth = Window:Tab({ Title = "å·èµ°è„‘çº¢", Icon = "heart" }),
    Other = Window:Tab({ Title = "å·¥å…·", Icon = "settings" })
}

Window:SelectTab(1)

Tabs.Home:Paragraph({
    Title = "æ¬¢è¿ä½¿ç”¨æœ¬ç†Šæ±‰åŒ–",
    Desc = "ä¸“ä¸ºRobloxè„šæœ¬æ±‰åŒ–",
})

Tabs.Home:Paragraph({
    Title = "æ›´æ–°å†…å®¹",
    Desc = "â€¢ å¢åŠ äº†å·èµ°è„‘çº¢æ±‰åŒ–ï¼Œä¼˜åŒ–äº†ç•Œé¢",
})

Tabs.Home:Section({Title = "ä¸»é¡µ"})

Tabs.Home:Button({
    Title = "å¤åˆ¶QQç¾¤å·",
    Callback = function()
        if safeSetClipboard("168985587") then
            WindUI:Notify({Title = "QQç¾¤å·", Content = "ç¾¤å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", Duration = 3})
        else
            WindUI:Notify({Title = "é”™è¯¯", Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", Duration = 3})
        end
    end
})

Tabs.Home:Button({
    Title = "å¤åˆ¶è€é¼ å¿«æ‰‹å·",
    Callback = function()
        if safeSetClipboard("lousun7891") then
            WindUI:Notify({Title = "å¿«æ‰‹å·", Content = "å¿«æ‰‹å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", Duration = 3})
        else
            WindUI:Notify({Title = "é”™è¯¯", Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", Duration = 3})
        end
    end
})

Tabs.Home:Section({Title = "å·¥å…·"})

-- åœ¨å·¥å…·éƒ¨åˆ†çš„é‡æ–°åŠ è½½æŒ‰é’®æ›¿æ¢ä¸ºä»¥ä¸‹ä»£ç ï¼š

Tabs.Home:Button({
    Title = "é‡æ–°åŠ è½½ç•Œé¢",
    Callback = function()
        WindUI:Notify({Title = "æç¤º", Content = "é‡æ–°åŠ è½½ç•Œé¢ä¸­...", Duration = 2})
        
        -- ä¿å­˜é‡è¦ä¿¡æ¯
        local savedData = {
            keySystemEnabled = Window.KeySystem and true or false,
            key = Window.KeySystem and Window.KeySystem.Key or nil
        }
        
        -- å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿é€šçŸ¥æ˜¾ç¤º
        task.wait(1)
        
        -- å®Œå…¨æ¸…ç†UI
        if Window then
            pcall(function() Window:Destroy() end)
            Window = nil
        end
        
        -- å¼ºåˆ¶åƒåœ¾å›æ”¶
        for i = 1, 5 do
            task.wait(0.1)
            collectgarbage("collect")
        end
        
        -- ä½¿ç”¨æ¸¸æˆçš„é‡ç½®åŠŸèƒ½ï¼ˆæ›´å¯é çš„æ–¹æ³•ï¼‰
        if game:GetService("CoreGui"):FindFirstChild("WindUI") then
            game:GetService("CoreGui").WindUI:Destroy()
        end
        
        -- é‡æ–°æ‰§è¡Œè„šæœ¬çš„æ›¿ä»£æ–¹æ¡ˆ
        task.wait(0.5)
        
        -- æ–¹æ³•1ï¼šå°è¯•é€šè¿‡é‡æ–°è·å–è„šæœ¬æ¥é‡å¯
        local success, result = pcall(function()
            local restartScript = httpGet("https://raw.githubusercontent.com/jbu7666gvv/benhan/main/benhan.lua")
            if restartScript then
                -- åˆ›å»ºæ–°çš„è„šæœ¬æ¥æ‰§è¡Œ
                local newScript = Instance.new("LocalScript")
                newScript.Source = restartScript
                newScript.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerScripts")
            else
                error("æ— æ³•è·å–é‡å¯è„šæœ¬")
            end
        end)
        
        if not success then
            -- æ–¹æ³•2ï¼šç®€å•çš„é‡æ–°åˆå§‹åŒ–
            WindUI:Notify({Title = "é”™è¯¯", Content = "å®Œå…¨é‡å¯å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é‡æ–°æ‰§è¡Œè„šæœ¬", Duration = 5})
        end
    end
})

Tabs.Main:Section({Title = "99å¤œè„šæœ¬"})

local mainScripts = {
    {
        Title = "h4x (è¦å¡å¯†)",
        Desc = "æ±‰åŒ–",
        URL = "https://raw.githubusercontent.com/jbu7666gvv/h4x6/refs/heads/main/h4x%E6%B1%89%E5%8C%96",
        RequiresKey = true
    },
    {
        Title = "è™šç©º (æ— å¡å¯†)", 
        Desc = "æ±‰åŒ–",
        URL = "https://raw.githubusercontent.com/jbu7666gvv/xuu/refs/heads/main/xuu",
        RequiresKey = false
    },
    {
        Title = "ToastyXD Hub (è¦å¡å¯†)",
        Desc = "æ±‰åŒ–ç‰ˆToastyXD Hub",
        URL = "https://raw.githubusercontent.com/jbu7666gvv/toastyxdhub/refs/heads/main/toastyxdhub",
        RequiresKey = true
    },
    {
        Title = "LunorLounge (è¦å¡å¯†)",
        Desc = "åŠæ±‰åŒ–ç‰ˆ - å·²åœæ­¢æ›´æ–°",
        URL = "https://raw.githubusercontent.com/jbu7666gvv/LunorLounge/refs/heads/main/LunorLounge",
        RequiresKey = true
    },
    {
        Title = "CpsHub(æ— å¡å¯†)",
        Desc = "æ±‰åŒ–",
        URL = "https://raw.githubusercontent.com/jbu7666gvv/CpsHub/refs/heads/main/CpsHub",
        RequiresKey = true
    }
}

for i, scriptInfo in ipairs(mainScripts) do
    Tabs.Main:Button({
        Title = scriptInfo.Title .. (scriptInfo.RequiresKey and KEY_ICON or CHECK_ICON),
        Desc = scriptInfo.Desc,
        Callback = function()
            loadScript(scriptInfo.URL, scriptInfo.Title)
        end
    })
end

Tabs.Ninja:Section({Title = "æ­»é“è½¨"})

Tabs.Ninja:Button({
    Title = "RINGTA (æ— å¡å¯†)" .. CHECK_ICON,
    Desc = "æ±‰åŒ–",
    Callback = function()
        loadScript("https://raw.githubusercontent.com/jbu7666gvv/ringtasi/main/ringtasi", "RINGTAè„šæœ¬")
    end
})

Tabs.Oth:Section({Title = "å·èµ°è„‘çº¢"})

Tabs.Oth:Button({
    Title = "MIRANDA HUB (æ— å¡å¯†)" .. CHECK_ICON,
    Desc = "æ±‰åŒ–",
    Callback = function()
        WindUI:Notify({Title = "æç¤º", Content = "æ­£åœ¨åŠ è½½è„šæœ¬...", Duration = 2})
        loadScript("https://raw.githubusercontent.com/jbu7666gvv/jianhan/refs/heads/main/1", "MIRANDA HUBè„šæœ¬")
    end
})

WindUI:Notify({Title = "æœ¬ç†Šæ±‰åŒ–", Content = "ç•Œé¢åŠ è½½å®Œæˆï¼è¯·é€‰æ‹©éœ€è¦çš„è„šæœ¬ã€‚", Duration = 4})
