-----------------------------------------------------------
-- 增强版自定义文件保存脚本（带UI提示）
-- 特点：简洁的UI提示，显示保存状态和文件路径
-----------------------------------------------------------
-- ================ 1. 基础服务与注入器兼容逻辑 ================
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players.PlayerAdded:Wait()
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

-- 注入器文件操作函数
local readFunc, writeFunc, getPathFunc
pcall(function()
    if type(syn) == "table" then
        readFunc = syn.readfile or readfile
        writeFunc = syn.writefile or writefile
        getPathFunc = syn.datapath
    else
        readFunc = readfile or readFile
        writeFunc = writefile or writeFile
        getPathFunc = function() return "Roblox/Scripts" end
    end
end)

-- ================ 2. 【关键配置区】这里随便改！ ================
-- 自定义1：要创建的文件名
local CUSTOM_FILE_NAME = "配置文件.lua"

-- 自定义2：要保存的内容
local CUSTOM_FILE_CONTENT = [[
-- 你的文件内容...
return {
    staticText = {
        ["Hello"] = "你好",
        ["World"] = "世界",
    }
}
]]

-- 自定义3：UI主题颜色（可修改）
local UI_THEME_COLOR = Color3.fromRGB(0, 170, 255) -- 蓝色主题

-- ================ 3. UI提示系统 ================
local function createNotification(message, isSuccess)
    -- 创建提示框
    local notification = Instance.new("Frame")
    notification.Name = "FileSaveNotification"
    notification.Size = UDim2.new(0, 300, 0, 80)
    notification.Position = UDim2.new(0.5, -150, 0, -100)
    notification.AnchorPoint = Vector2.new(0.5, 0)
    notification.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    notification.BorderSizePixel = 0
    notification.ZIndex = 100
    
    -- 圆角
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = notification
    
    -- 边框
    local stroke = Instance.new("UIStroke")
    stroke.Color = isSuccess and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(200, 0, 0)
    stroke.Thickness = 2
    stroke.Parent = notification
    
    -- 图标
    local icon = Instance.new("ImageLabel")
    icon.Size = UDim2.new(0, 32, 0, 32)
    icon.Position = UDim2.new(0, 15, 0, 15)
    icon.BackgroundTransparency = 1
    icon.Image = isSuccess and "rbxassetid://10734948225" or "rbxassetid://10734948908" -- 成功/失败图标
    icon.Parent = notification
    
    -- 标题
    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1, -60, 0, 20)
    title.Position = UDim2.new(0, 55, 0, 15)
    title.BackgroundTransparency = 1
    title.Text = isSuccess and "保存成功" or "保存失败"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 16
    title.Font = Enum.Font.GothamBold
    title.TextXAlignment = Enum.TextXAlignment.Left
    title.Parent = notification
    
    -- 消息内容
    local messageLabel = Instance.new("TextLabel")
    messageLabel.Size = UDim2.new(1, -60, 1, -40)
    messageLabel.Position = UDim2.new(0, 55, 0, 35)
    messageLabel.BackgroundTransparency = 1
    messageLabel.Text = message
    messageLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    messageLabel.TextSize = 14
    messageLabel.Font = Enum.Font.Gotham
    messageLabel.TextXAlignment = Enum.TextXAlignment.Left
    messageLabel.TextYAlignment = Enum.TextYAlignment.Top
    messageLabel.TextWrapped = true
    messageLabel.Parent = notification
    
    -- 进度条（用于显示自动关闭进度）
    local progressBar = Instance.new("Frame")
    progressBar.Size = UDim2.new(1, 0, 0, 3)
    progressBar.Position = UDim2.new(0, 0, 1, -3)
    progressBar.BackgroundColor3 = UI_THEME_COLOR
    progressBar.BorderSizePixel = 0
    progressBar.Parent = notification
    
    local progressCorner = Instance.new("UICorner")
    progressCorner.CornerRadius = UDim.new(0, 2)
    progressCorner.Parent = progressBar
    
    -- 添加到玩家GUI
    local playerGui = LocalPlayer:WaitForChild("PlayerGui")
    notification.Parent = playerGui
    
    -- 显示动画
    notification.Position = UDim2.new(0.5, -150, 0, -100)
    local tweenIn = TweenService:Create(notification, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
        Position = UDim2.new(0.5, -150, 0, 20)
    })
    tweenIn:Play()
    
    -- 5秒后自动关闭
    local closeTime = 5
    local startTime = tick()
    
    local connection
    connection = RunService.Heartbeat:Connect(function()
        local elapsed = tick() - startTime
        local progress = elapsed / closeTime
        
        -- 更新进度条
        progressBar.Size = UDim2.new(1 - progress, 0, 0, 3)
        
        if elapsed >= closeTime then
            connection:Disconnect()
            -- 关闭动画
            local tweenOut = TweenService:Create(notification, TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
                Position = UDim2.new(0.5, -150, 0, -100)
            })
            tweenOut:Play()
            
            -- 动画结束后销毁
            tweenOut.Completed:Connect(function()
                notification:Destroy()
            end)
        end
    end)
    
    -- 点击关闭功能
    notification.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            connection:Disconnect()
            local tweenOut = TweenService:Create(notification, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                Position = UDim2.new(0.5, -150, 0, -100)
            })
            tweenOut:Play()
            tweenOut.Completed:Connect(function()
                notification:Destroy()
            end)
        end
    end)
end

-- ================ 4. 核心工具函数 ================
local function getFinalSavePath()
    local basePath
    if getPathFunc then
        basePath = getPathFunc()
    else
        basePath = "C:/RobloxCustomFiles"
        pcall(function()
            if string.find(game:GetService("MarketplaceService"):GetProductInfo(1).Name, "Mac") then
                basePath = "~/Library/RobloxCustomFiles"
            end
        end)
    end
    local safeFileName = CUSTOM_FILE_NAME:gsub("[\\/:*?\"<>|]", "_")
    return basePath .. "/" .. safeFileName
end

-- 增强的文件保存函数（带UI提示）
local function enhancedSaveFile()
    if not writeFunc then
        createNotification("当前注入器不支持文件写入功能", false)
        return
    end

    local savePath = getFinalSavePath()
    local success, err = pcall(writeFunc, savePath, CUSTOM_FILE_CONTENT)
    
    if success then
        createNotification("文件保存成功！\n路径: " .. savePath, true)
        warn("配置文件保存成功: " .. savePath)
    else
        createNotification("文件保存失败: " .. tostring(err), false)
        warn("配置文件保存失败: " .. tostring(err))
    end
end

-- ================ 5. 启动入口 ================
pcall(function()
    -- 延迟一秒显示，确保游戏完全加载
    wait(1)
    enhancedSaveFile()
end)

-- ================ 6. 可选：创建测试按钮（开发用） ================
local function createTestButton()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "FileSaveTestUI"
    screenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 200, 0, 50)
    button.Position = UDim2.new(0, 20, 0, 20)
    button.BackgroundColor3 = UI_THEME_COLOR
    button.Text = "测试保存文件"
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.TextSize = 16
    button.Font = Enum.Font.GothamBold
    
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button
    
    button.MouseButton1Click:Connect(enhancedSaveFile)
    button.Parent = screenGui
end

-- 取消下面这行的注释来显示测试按钮（开发时使用）
-- createTestButton()
