-- 99夜强制保护 - 更积极的保护方式
local Night99ForceGod = false

Tabs.General:Toggle({
    Title = "99夜强制保护",
    Desc = "更积极的保护，防止各种死亡",
    Value = false,
    Callback = function(state)
        safeCall(function()
            Night99ForceGod = state
            
            if state then
                WindUI:Notify({
                    Title = "提示",
                    Content = "强制保护已开启",
                    Duration = 3,
                    Color = ColorSystem.successColor
                })
                
                local forceLoop
                forceLoop = game:GetService("RunService").Heartbeat:Connect(function()
                    if not Night99ForceGod then
                        forceLoop:Disconnect()
                        return
                    end
                    
                    pcall(function()
                        local char = LP.Character
                        if char then
                            local humanoid = char:FindFirstChildWhichIsA("Humanoid")
                            if humanoid then
                                -- 方法1：强制设置生命值
                                humanoid.Health = 100
                                humanoid.MaxHealth = 100
                                
                                -- 方法2：防止死亡状态
                                if humanoid:GetState() == Enum.HumanoidStateType.Dead then
                                    humanoid:ChangeState(Enum.HumanoidStateType.Running)
                                end
                                
                                -- 方法3：检查并修复所有数值属性
                                for _, child in pairs(char:GetDescendants()) do
                                    if child:IsA("NumberValue") or child:IsA("IntValue") then
                                        if child.Name:lower():find("health") or 
                                           child.Name:lower():find("hunger") or 
                                           child.Name:lower():find("thirst") then
                                            if child.Value < 50 then
                                                child.Value = 100
                                            end
                                        end
                                    end
                                end
                            end
                        end
                    end)
                end)
                
                -- 保存连接
                _G.ForceGodLoop = forceLoop
                
            else
                WindUI:Notify({
                    Title = "提示",
                    Content = "强制保护已关闭",
                    Duration = 3,
                    Color = ColorSystem.primaryColor
                })
                
                if _G.ForceGodLoop then
                    _G.ForceGodLoop:Disconnect()
                    _G.ForceGodLoop = nil
                end
            end
        end, "切换强制保护")
    end
})
