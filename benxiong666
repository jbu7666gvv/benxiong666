local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- ç®€åŒ–çš„æ±‰åŒ–è¯å…¸ï¼ˆæµ‹è¯•ç”¨ï¼‰
local translationDict = {
    ["Player"] = "ç©å®¶",
    ["Settings"] = "è®¾ç½®",
    ["Menu"] = "èœå•",
    ["Start"] = "å¼€å§‹",
    ["Stop"] = "åœæ­¢",
    ["Enable"] = "å¯ç”¨",
    ["Disable"] = "ç¦ç”¨",
    ["OK"] = "ç¡®å®š",
    ["Cancel"] = "å–æ¶ˆ",
    ["Close"] = "å…³é—­",
    ["Open"] = "æ‰“å¼€",
    ["Yes"] = "æ˜¯",
    ["No"] = "å¦"
}

-- å­˜å‚¨åŸå§‹æ–‡æœ¬
local originalTexts = {}
local isTranslating = false
local mainUI = nil
local colorAnimationConnection = nil

-- å½©è™¹è‰²åºåˆ—
local rainbowColors = {
    Color3.fromRGB(255, 0, 0),      -- çº¢è‰²
    Color3.fromRGB(255, 127, 0),    -- æ©™è‰²
    Color3.fromRGB(255, 255, 0),    -- é»„è‰²
    Color3.fromRGB(0, 255, 0),      -- ç»¿è‰²
    Color3.fromRGB(0, 0, 255),      -- è“è‰²
    Color3.fromRGB(75, 0, 130),     -- é›è“è‰²
    Color3.fromRGB(148, 0, 211)     -- ç´«è‰²
}

-- éœ“è™¹è‰²åºåˆ—
local neonColors = {
    Color3.fromRGB(255, 0, 255),    -- ç²‰çº¢
    Color3.fromRGB(0, 255, 255),    -- é’è‰²
    Color3.fromRGB(255, 255, 0),    -- é»„è‰²
    Color3.fromRGB(0, 255, 0),      -- äº®ç»¿
    Color3.fromRGB(255, 0, 0),      -- äº®çº¢
    Color3.fromRGB(0, 0, 255)       -- äº®è“
}

-- æ¸å˜è‰²åºåˆ—
local gradientColors = {
    Color3.fromRGB(255, 105, 180),  -- çƒ­ç²‰çº¢
    Color3.fromRGB(65, 105, 225),   -- çš‡å®¶è“
    Color3.fromRGB(50, 205, 50),    -- çŸ³ç°ç»¿
    Color3.fromRGB(255, 165, 0),    -- æ©™è‰²
    Color3.fromRGB(138, 43, 226),   -- ç´«ç½—å…°
    Color3.fromRGB(0, 191, 255)     -- æ·±å¤©è“
}

local currentColorScheme = rainbowColors
local currentColorIndex = 1

-- å®‰å…¨çš„PCallåŒ…è£…å‡½æ•°
local function safeCall(func, errorMessage)
    local success, result = pcall(func)
    if not success then
        warn(errorMessage .. ": " .. tostring(result))
        return nil
    end
    return result
end

-- é¢œè‰²åŠ¨ç”»å‡½æ•°
local function startColorAnimation(uiElements)
    if colorAnimationConnection then
        colorAnimationConnection:Disconnect()
    end
    
    colorAnimationConnection = RunService.Heartbeat:Connect(function(deltaTime)
        currentColorIndex = (currentColorIndex % #currentColorScheme) + 1
        local currentColor = currentColorScheme[currentColorIndex]
        local nextColorIndex = (currentColorIndex % #currentColorScheme) + 1
        local nextColor = currentColorScheme[nextColorIndex]
        
        -- åˆ›å»ºå¹³æ»‘è¿‡æ¸¡é¢œè‰²
        local lerpFactor = math.sin(tick() * 3) * 0.5 + 0.5
        local animatedColor = currentColor:Lerp(nextColor, lerpFactor)
        
        -- åº”ç”¨é¢œè‰²åˆ°æ‰€æœ‰UIå…ƒç´ 
        for _, element in pairs(uiElements) do
            if element and element.Parent then
                pcall(function()
                    if element:IsA("Frame") or element:IsA("TextButton") then
                        element.BackgroundColor3 = animatedColor
                        
                        -- åˆ›å»ºäº’è¡¥è‰²ç”¨äºæ–‡æœ¬
                        local textColor = Color3.new(
                            1 - animatedColor.R,
                            1 - animatedColor.G, 
                            1 - animatedColor.B
                        )
                        
                        -- å¦‚æœå…ƒç´ æœ‰æ–‡æœ¬ï¼Œè®¾ç½®æ–‡æœ¬é¢œè‰²
                        if element:IsA("TextButton") or element:IsA("TextLabel") then
                            element.TextColor3 = textColor
                        end
                    end
                end)
            end
        end
    end)
end

-- åœæ­¢é¢œè‰²åŠ¨ç”»
local function stopColorAnimation()
    if colorAnimationConnection then
        colorAnimationConnection:Disconnect()
        colorAnimationConnection = nil
    end
end

-- åˆ›å»ºå½©è‰²UI
local function createColorfulUI()
    return safeCall(function()
        local screenGui = Instance.new("ScreenGui")
        screenGui.Name = "ColorfulTranslatorUI_MrPopCat14"
        screenGui.ResetOnSpawn = false
        screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
        
        -- ä¸»æ¡†æ¶
        local mainFrame = Instance.new("Frame")
        mainFrame.Size = UDim2.new(0, 280, 0, 200)
        mainFrame.Position = UDim2.new(0, 20, 0, 20)
        mainFrame.BackgroundColor3 = Color3.fromRGB(255, 105, 180) -- åˆå§‹çƒ­ç²‰çº¢è‰²
        mainFrame.BorderSizePixel = 0
        mainFrame.Parent = screenGui
        
        local corner = Instance.new("UICorner")
        corner.CornerRadius = UDim.new(0, 12)
        corner.Parent = mainFrame
        
        -- å‘å…‰æ•ˆæœ
        local glow = Instance.new("UIStroke")
        glow.Color = Color3.fromRGB(255, 255, 255)
        glow.Thickness = 3
        glow.Parent = mainFrame
        
        -- æ ‡é¢˜
        local title = Instance.new("TextLabel")
        title.Size = UDim2.new(1, 0, 0, 45)
        title.Position = UDim2.new(0, 0, 0, 0)
        title.BackgroundColor3 = Color3.fromRGB(138, 43, 226) -- åˆå§‹ç´«ç½—å…°è‰²
        title.Text = "ğŸŒˆ è‡ªåŠ¨æ±‰åŒ–ç³»ç»Ÿ v2.0 ğŸŒˆ"
        title.TextColor3 = Color3.fromRGB(255, 255, 255)
        title.TextScaled = true
        title.Font = Enum.Font.GothamBold
        title.TextStrokeTransparency = 0.5
        title.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        title.Parent = mainFrame
        
        local titleCorner = Instance.new("UICorner")
        titleCorner.CornerRadius = UDim.new(0, 12)
        titleCorner.Parent = title
        
        -- ä¸»æŒ‰é’®
        local toggleButton = Instance.new("TextButton")
        toggleButton.Size = UDim2.new(0.85, 0, 0, 55)
        toggleButton.Position = UDim2.new(0.075, 0, 0.25, 0)
        toggleButton.BackgroundColor3 = Color3.fromRGB(65, 105, 225) -- åˆå§‹çš‡å®¶è“
        toggleButton.Text = "ğŸ¯ å¼€å¯æ±‰åŒ–"
        toggleButton.TextColor3 = Color3.fromRGB(255, 255, 255)
        toggleButton.TextScaled = true
        toggleButton.Font = Enum.Font.GothamBold
        toggleButton.TextStrokeTransparency = 0.3
        toggleButton.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        toggleButton.Parent = mainFrame
        
        local buttonCorner = Instance.new("UICorner")
        buttonCorner.CornerRadius = UDim.new(0, 10)
        buttonCorner.Parent = toggleButton
        
        -- æŒ‰é’®å‘å…‰æ•ˆæœ
        local buttonGlow = Instance.new("UIStroke")
        buttonGlow.Color = Color3.fromRGB(255, 255, 255)
        buttonGlow.Thickness = 2
        buttonGlow.Parent = toggleButton
        
        -- çŠ¶æ€æ˜¾ç¤º
        local statusLabel = Instance.new("TextLabel")
        statusLabel.Size = UDim2.new(0.85, 0, 0, 50)
        statusLabel.Position = UDim2.new(0.075, 0, 0.6, 0)
        statusLabel.BackgroundTransparency = 0.8
        statusLabel.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
        statusLabel.Text = "âœ¨ çŠ¶æ€: ç­‰å¾…å¯åŠ¨ âœ¨"
        statusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        statusLabel.TextScaled = true
        statusLabel.TextWrapped = true
        statusLabel.Font = Enum.Font.Gotham
        statusLabel.TextStrokeTransparency = 0.5
        statusLabel.TextStrokeColor3 = Color3.fromRGB(0, 0, 0)
        statusLabel.Parent = mainFrame
        
        local statusCorner = Instance.new("UICorner")
        statusCorner.CornerRadius = UDim.new(0, 8)
        statusCorner.Parent = statusLabel
        
        -- æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        toggleButton.MouseButton1Click:Connect(function()
            isTranslating = not isTranslating
            
            if isTranslating then
                toggleButton.Text = "ğŸ”´ å…³é—­æ±‰åŒ–"
                statusLabel.Text = "ğŸ¨ çŠ¶æ€: æ±‰åŒ–è¿›è¡Œä¸­... ğŸ¨"
                startTranslation()
            else
                toggleButton.Text = "ğŸ¯ å¼€å¯æ±‰åŒ–"
                statusLabel.Text = "âœ¨ çŠ¶æ€: æ±‰åŒ–å·²å…³é—­ âœ¨"
                restoreOriginalTexts()
            end
        end)
        
        -- æŒ‰é’®æ‚¬åœæ•ˆæœ
        toggleButton.MouseEnter:Connect(function()
            local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(toggleButton, tweenInfo, {Size = UDim2.new(0.88, 0, 0, 58)})
            tween:Play()
        end)
        
        toggleButton.MouseLeave:Connect(function()
            local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
            local tween = TweenService:Create(toggleButton, tweenInfo, {Size = UDim2.new(0.85, 0, 0, 55)})
            tween:Play()
        end)
        
        screenGui.Parent = playerGui
        
        -- å¼€å§‹é¢œè‰²åŠ¨ç”»
        local uiElements = {mainFrame, title, toggleButton}
        startColorAnimation(uiElements)
        
        return screenGui
    end, "åˆ›å»ºå½©è‰²UIå¤±è´¥")
end

-- ç¿»è¯‘æ–‡æœ¬
local function translateText(text)
    if type(text) ~= "string" or text == "" then
        return text
    end
    
    local translated = text
    for eng, chn in pairs(translationDict) do
        translated = string.gsub(translated, eng, chn)
    end
    
    return translated
end

-- å­˜å‚¨åŸå§‹æ–‡æœ¬
local function storeOriginalText(object, property, value)
    if not originalTexts[object] then
        originalTexts[object] = {}
    end
    originalTexts[object][property] = value
end

-- å¤„ç†GUIå¯¹è±¡
local function processGUIObject(obj)
    safeCall(function()
        if obj:IsA("TextLabel") or obj:IsA("TextButton") or obj:IsA("TextBox") then
            local text = obj.Text
            if text and text ~= "" then
                local translated = translateText(text)
                if translated ~= text then
                    storeOriginalText(obj, "Text", text)
                    obj.Text = translated
                end
            end
        end
    end, "å¤„ç†GUIå¯¹è±¡å¤±è´¥: " .. obj:GetFullName())
end

-- é€’å½’å¤„ç†æ‰€æœ‰GUIå¯¹è±¡
local function processAllGUIObjects(parent)
    safeCall(function()
        for _, child in ipairs(parent:GetChildren()) do
            processGUIObject(child)
            processAllGUIObjects(child)
        end
    end, "é€’å½’å¤„ç†GUIå¤±è´¥")
end

-- æ¢å¤åŸå§‹æ–‡æœ¬
local function restoreOriginalTexts()
    safeCall(function()
        for obj, properties in pairs(originalTexts) do
            if obj and obj.Parent then
                for property, value in pairs(properties) do
                    pcall(function()
                        obj[property] = value
                    end)
                end
            end
        end
        originalTexts = {}
    end, "æ¢å¤åŸå§‹æ–‡æœ¬å¤±è´¥")
end

-- å¼€å§‹ç¿»è¯‘
local function startTranslation()
    safeCall(function()
        -- å¤„ç†ç°æœ‰GUI
        processAllGUIObjects(playerGui)
        
        -- ç›‘å¬æ–°åˆ›å»ºçš„GUIå¯¹è±¡
        local connection
        connection = playerGui.DescendantAdded:Connect(function(descendant)
            if isTranslating then
                processGUIObject(descendant)
            else
                connection:Disconnect()
            end
        end)
    end, "å¯åŠ¨ç¿»è¯‘è¿‡ç¨‹å¤±è´¥")
end

-- åˆå§‹åŒ–ç³»ç»Ÿ
local function initialize()
    safeCall(function()
        -- ç­‰å¾…PlayerGuiå®Œå…¨åŠ è½½
        if not playerGui then
            playerGui = player:WaitForChild("PlayerGui")
        end
        
        -- åˆ›å»ºå½©è‰²UI
        mainUI = createColorfulUI()
        
        if mainUI then
            print("ğŸŒˆ å½©è‰²è‡ªåŠ¨æ±‰åŒ–ç³»ç»ŸåŠ è½½æˆåŠŸï¼")
            print("ğŸ¨ åŠ¨æ€å˜è‰²UIå·²æ˜¾ç¤ºåœ¨å±å¹•å·¦ä¸Šè§’")
            print("ğŸ¯ ç‚¹å‡»æŒ‰é’®å¼€å¯/å…³é—­è‡ªåŠ¨æ±‰åŒ–")
        else
            warn("âŒ å½©è‰²è‡ªåŠ¨æ±‰åŒ–ç³»ç»ŸUIåˆ›å»ºå¤±è´¥")
        end
    end, "åˆå§‹åŒ–ç³»ç»Ÿå¤±è´¥")
end

-- å»¶è¿Ÿåˆå§‹åŒ–ï¼Œç¡®ä¿æ¸¸æˆå®Œå…¨åŠ è½½
local function delayedInitialize()
    safeCall(function()
        -- ç­‰å¾…3ç§’ç¡®ä¿æ¸¸æˆå®Œå…¨åŠ è½½
        wait(3)
        initialize()
    end, "å»¶è¿Ÿåˆå§‹åŒ–å¤±è´¥")
end

-- æ¸…ç†å‡½æ•°
local function cleanup()
    stopColorAnimation()
    if mainUI then
        mainUI:Destroy()
    end
end

-- æ¸¸æˆé€€å‡ºæ—¶æ¸…ç†
game:GetService("UserInputService").WindowFocused:Connect(function()
    -- çª—å£è·å¾—ç„¦ç‚¹æ—¶æ¢å¤åŠ¨ç”»
    if mainUI and mainUI.Parent then
        local uiElements = {}
        for _, child in ipairs(mainUI:GetDescendants()) do
            if child:IsA("Frame") or child:IsA("TextButton") then
                table.insert(uiElements, child)
            end
        end
        startColorAnimation(uiElements)
    end
end)

game:GetService("UserInputService").WindowFocusReleased:Connect(function()
    -- çª—å£å¤±å»ç„¦ç‚¹æ—¶æš‚åœåŠ¨ç”»ä»¥èŠ‚çœæ€§èƒ½
    stopColorAnimation()
end)

-- å¯åŠ¨ç³»ç»Ÿ
delayedInitialize()
