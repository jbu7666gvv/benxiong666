local AUTO_CHAT_MSG = "ç§‹å®¹çœ‰ç›®"

-- =============================================
-- ğŸ”’ ç®€åŒ–ç‰ˆåæŠ“åŒ…ä¿æŠ¤ç³»ç»Ÿ
-- =============================================
local AntiSpySystem = {
    Enabled = true,
    DetectionCount = 0,
    BlockedRequests = 0
}

warn("[åæŠ“åŒ…ä¿æŠ¤] ç³»ç»Ÿåˆå§‹åŒ–")

-- ç®€åŒ–çš„ç›‘æ§æ£€æµ‹
local function quickSecurityCheck()
    -- åªè¿›è¡ŒåŸºæœ¬æ£€æŸ¥ï¼Œé¿å…å¤æ‚æ“ä½œå¯¼è‡´é”™è¯¯
    local suspiciousTerms = {"fiddler", "wireshark", "charles", "burp", "mitmproxy"}
    
    -- ç®€å•çš„ç”¨æˆ·ä»£ç†æ£€æŸ¥ï¼ˆå¦‚æœå¯ç”¨ï¼‰
    if game:GetService("HttpService").JSONEncode then
        local success, result = pcall(function()
            return game:HttpGet("https://httpbin.org/user-agent", true)
        end)
        
        if success and result then
            local lowerResult = result:lower()
            for _, term in ipairs(suspiciousTerms) do
                if lowerResult:find(term) then
                    warn("[åæŠ“åŒ…ä¿æŠ¤] æ£€æµ‹åˆ°ç›‘æ§å·¥å…·: " .. term)
                    return true
                end
            end
        end
    end
    
    return false
end

-- å®‰å…¨çš„HTTPåŒ…è£…å™¨
local function createSafeHttpWrapper(originalFunc)
    return function(url, ...)
        -- å¿«é€Ÿå®‰å…¨æ£€æŸ¥
        if quickSecurityCheck() then
            AntiSpySystem.BlockedRequests = AntiSpySystem.BlockedRequests + 1
            warn("[åæŠ“åŒ…ä¿æŠ¤] å·²é˜»æ­¢è¯·æ±‚: " .. tostring(url))
            return ""
        end
        
        -- æ‰§è¡ŒåŸå§‹è¯·æ±‚
        local success, result = pcall(function()
            return originalFunc(url, ...)
        end)
        
        return success and result or ""
    end
end

-- ä¿æŠ¤ç¬¬ä¸‰æ–¹HTTPåº“ï¼ˆå®‰å…¨æ–¹å¼ï¼‰
local function setupHttpProtection()
    -- ä¿æŠ¤game:HttpGet
    if not _G.HttpGetProtected then
        local originalHttpGet = game.HttpGet
        game.HttpGet = createSafeHttpWrapper(originalHttpGet)
        _G.HttpGetProtected = true
    end
    
    -- ä¿æŠ¤synåº“ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if syn and syn.request and not _G.SynProtected then
        local originalSynRequest = syn.request
        syn.request = function(options)
            if quickSecurityCheck() then
                return {Success = false, Body = ""}
            end
            return originalSynRequest(options)
        end
        _G.SynProtected = true
    end
    
    -- ä¿æŠ¤requeståº“ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
    if request and not _G.RequestProtected then
        local originalRequest = request
        request = function(options)
            if quickSecurityCheck() then
                return {Success = false, Body = ""}
            end
            return originalRequest(options)
        end
        _G.RequestProtected = true
    end
end

-- å»¶è¿Ÿè®¾ç½®ä¿æŠ¤ï¼Œç¡®ä¿å…¶ä»–åŠŸèƒ½å…ˆåŠ è½½
task.spawn(function()
    wait(2) -- ç­‰å¾…2ç§’è®©å…¶ä»–ç³»ç»Ÿç¨³å®š
    setupHttpProtection()
    warn("[åæŠ“åŒ…ä¿æŠ¤] âœ… ä¿æŠ¤ç³»ç»Ÿå·²æ¿€æ´»")
end)

-- æ·»åŠ ç¼ºå¤±çš„å‡½æ•°
local function NoFog()
    if game.Lighting:FindFirstChildOfClass("Atmosphere") then
        game.Lighting:FindFirstChildOfClass("Atmosphere"):Destroy()
    end
    if game.Lighting:FindFirstChildOfClass("Sky") then
        game.Lighting:FindFirstChildOfClass("Sky"):Destroy()
    end
    game.Lighting.FogEnd = 100000
end

-- æ·»åŠ  httpGet å‡½æ•°
local function httpGet(url)
    return safeHttpGet(url)
end

-- å®‰å…¨çš„æ‰§è¡Œå™¨è¯†åˆ«å‡½æ•°
local function getExecutorName()
    if identifyexecutor then
        return identifyexecutor() or "æœªçŸ¥"
    elseif syn and syn.request then
        return "Synapse X"
    elseif KRNL_LOADED then
        return "KRNL"
    elseif fluxus then
        return "Fluxus"
    elseif getexecutorname then
        return getexecutorname() or "æœªçŸ¥"
    else
        return "æœªçŸ¥æ‰§è¡Œå™¨"
    end
end

-- æ”¾å®½URLå®‰å…¨æ£€æŸ¥å‡½æ•°
local function isValidURL(url)
    -- å…è®¸æ‰€æœ‰å¸¸è§è„šæœ¬æ‰˜ç®¡ç½‘ç«™
    local allowedDomains = {
        "github.com", "raw.githubusercontent.com", "gist.githubusercontent.com",
        "pastebin.com", "pastefy.app", "rentry.co", "codeberg.org",
        "gitlab.com", "bitbucket.org", "cdn.jsdelivr.net", "gitcdn.link",
        "raw.githack.com", "statically.io"
    }
    
    -- å¦‚æœæ˜¯ç©ºURLï¼Œå…è®¸ï¼ˆç”¨äºæŸäº›ä¸éœ€è¦URLçš„åŠŸèƒ½ï¼‰
    if not url or url == "" then
        return true
    end
    
    -- æ£€æŸ¥æ˜¯å¦åŒ…å«å…è®¸çš„åŸŸå
    local lowerUrl = url:lower()
    for _, domain in ipairs(allowedDomains) do
        if string.find(lowerUrl, domain:lower(), 1, true) then
            return true
        end
    end
    
    -- å…è®¸data URLså’Œæœ¬åœ°æ–‡ä»¶ï¼ˆåœ¨Robloxç¯å¢ƒä¸­é€šå¸¸æ˜¯å®‰å…¨çš„ï¼‰
    if string.find(lowerUrl, "^data:") or string.find(lowerUrl, "^roblox") then
        return true
    end
    
    warn("URLå®‰å…¨æ£€æŸ¥å¤±è´¥: " .. url)
    return false
end

-- æ”¾å®½ä»£ç å®‰å…¨æ£€æŸ¥å‡½æ•°
local function isCodeSafe(code)
    if not code then
        return false, "ä»£ç å†…å®¹ä¸ºç©º"
    end
    
    -- æœ€å°é•¿åº¦æ£€æŸ¥
    if #code < 5 then
        return false, "ä»£ç å†…å®¹è¿‡çŸ­"
    end
    
    -- åªæ£€æŸ¥çœŸæ­£å±é™©çš„æ¨¡å¼
    local dangerousPatterns = {
        "rmdir%s*%(", "delfile%s*%(", "format%s*%(", 
        "shutdown%s*%(", "restart%s*%(", "coroutine%.wrap",
        "getfenv%s*%(", "setfenv%s*%(", "hookfunction"
    }
    
    for _, pattern in ipairs(dangerousPatterns) do
        if string.find(code, pattern) then
            return false, "æ£€æµ‹åˆ°å±é™©ä»£ç æ¨¡å¼: " .. pattern
        end
    end
    
    return true, "ä»£ç å®‰å…¨æ£€æŸ¥é€šè¿‡"
end

-- å¿«é€Ÿç»ˆæèŠå¤©æ–¹æ¡ˆï¼ˆå¤§å¹…å‡å°‘ç­‰å¾…æ—¶é—´ï¼‰
local function fastUltimateChatSend()
    local message = AUTO_CHAT_MSG
    if not message or message == "" then return end
    
    -- å¹¶è¡Œæ£€æŸ¥æ¸¸æˆçŠ¶æ€
    local gameLoaded = game:IsLoaded()
    local localPlayer = game:GetService("Players").LocalPlayer
    
    -- å¿«é€Ÿå°è¯•æ‰€æœ‰æ–¹æ³•ï¼ˆä¸ç­‰å¾…ï¼‰
    local methods = {
        function()
            if game:GetService("TextChatService") then
                local tcs = game:GetService("TextChatService")
                if tcs.TextChannels then
                    for _, channel in pairs(tcs.TextChannels:GetChildren()) do
                        if channel:IsA("TextChannel") and channel.SendAsync then
                            channel:SendAsync(message)
                            return true
                        end
                    end
                end
            end
            return false
        end,
        
        function()
            local rs = game:GetService("ReplicatedStorage")
            local events = {
                rs:FindFirstChild("DefaultChatSystemChatEvents"),
                rs:FindFirstChild("ChatEvents")
            }
            
            for _, eventFolder in ipairs(events) do
                if eventFolder then
                    local sayEvent = eventFolder:FindFirstChild("SayMessageRequest") or 
                                   eventFolder:FindFirstChild("SendMessage")
                    if sayEvent then
                        sayEvent:FireServer(message, "All")
                        return true
                    end
                end
            end
            return false
        end,
        
        function()
            if localPlayer and localPlayer:FindFirstChild("Chat") then
                localPlayer:Chat(message)
                return true
            end
            return false
        end
    }
    
    -- å¿«é€Ÿå°è¯•ï¼ˆæ€»å…±ä¸è¶…è¿‡1ç§’ï¼‰
    for _, method in ipairs(methods) do
        local success = pcall(method)
        if success then return true end
        wait(0.1) -- å‡å°‘ç­‰å¾…æ—¶é—´
    end
    
    return false
end

-- å¿«é€Ÿåˆå§‹åŒ–ï¼ˆä¸é˜»å¡UIåŠ è½½ï¼‰
task.spawn(function()
    -- æœ€å°åŒ–ç­‰å¾…
    if not game:IsLoaded() then
        game.Loaded:Wait()
    end
    
    local players = game:GetService("Players")
    if not players.LocalPlayer then
        players.PlayerAdded:Wait()
    end
    
    -- åªç­‰å¾…1ç§’å°±å¼€å§‹å°è¯•
    wait(1)
    
    -- å¿«é€Ÿå°è¯•2æ¬¡
    for i = 1, 2 do
        local success = fastUltimateChatSend()
        if success then break end
        wait(0.5)
    end
end)

-- ç«‹å³ç»§ç»­UIåŠ è½½ï¼Œä¸ç­‰å¾…èŠå¤©åŠŸèƒ½

-- å¢å¼ºçš„é”™è¯¯å¤„ç†
local function enhancedErrorHandler(err)
    local errMsg = "æœ¬ç†Šè„šæœ¬é”™è¯¯: " .. tostring(err)
    warn(errMsg)
    
    -- å°è¯•ä½¿ç”¨åŸºæœ¬é€šçŸ¥ç³»ç»Ÿ
    local success, notifyErr = pcall(function()
        if game:GetService("StarterGui"):GetCore("SendNotification") then
            game:GetService("StarterGui"):SetCore("SendNotification", {
                Title = "è„šæœ¬é”™è¯¯",
                Text = tostring(err),
                Duration = 5,
                Icon = "error"
            })
        end
    end)
    
    -- å¦‚æœåŸºæœ¬é€šçŸ¥ä¹Ÿå¤±è´¥ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°
    if not success then
        print(errMsg)
    end
end

local success, err = xpcall(function()
    -- ç¯å¢ƒæ£€æŸ¥å’Œå®‰å…¨å‡½æ•°å®šä¹‰
    local function safeRequire(func, fallback)
        local success, result = pcall(func)
        return success and result or fallback
    end

    -- ç¼“å­˜å¸¸ç”¨å‡½æ•°
    local task_wait = task.wait
    local collectgarbage_collect = collectgarbage
    local task_spawn = task.spawn

    -- ç®€å•çš„é¢œè‰²ç³»ç»Ÿï¼ˆç§»é™¤åŠ¨æ€æ•ˆæœï¼‰
    local ColorSystem = {
        primaryColor = Color3.fromRGB(0, 170, 255),
        successColor = Color3.fromRGB(0, 255, 0),
        errorColor = Color3.fromRGB(255, 0, 0),
        warningColor = Color3.fromRGB(255, 165, 0)
    }

    -- å®‰å…¨çš„ HTTP è·å–ï¼ˆå®½æ¾ç‰ˆæœ¬ï¼‰
    local function safeHttpGet(url)
        if not isValidURL(url) then
            warn("URLå®‰å…¨æ£€æŸ¥è­¦å‘Š: " .. tostring(url))
            -- å®½æ¾æ¨¡å¼ï¼šå³ä½¿URLæ£€æŸ¥å¤±è´¥ä¹Ÿå°è¯•åŠ è½½ï¼Œä½†è®°å½•è­¦å‘Š
        end
        
        local success, result = pcall(function()
            if game.HttpGet then
                return game:HttpGet(url, true)
            elseif syn and syn.request then
                local response = syn.request({
                    Url = url, 
                    Method = "GET",
                    Timeout = 10
                })
                return response.Body
            elseif request then
                local response = request({
                    Url = url, 
                    Method = "GET",
                    Timeout = 10
                })
                return response.Body
            else
                error("æ²¡æœ‰å¯ç”¨çš„ HTTP æ–¹æ³•")
            end
        end)
        return success and result or nil
    end

    -- å®‰å…¨çš„å‰ªè´´æ¿æ“ä½œ
    local function safeSetClipboard(text)
        local success, err = pcall(function()
            if setclipboard then
                setclipboard(text)
            elseif syn and syn.write_clipboard then
                syn.write_clipboard(text)
            elseif write_clipboard then
                write_clipboard(text)
            else
                error("æ²¡æœ‰å¯ç”¨çš„å‰ªè´´æ¿æ–¹æ³•")
            end
        end)
        return success
    end

    -- å®‰å…¨è°ƒç”¨å‡½æ•°
    local function safeCall(func, errorMessage)
        local success, err = pcall(func)
        if not success then
            if WindUI then
                WindUI:Notify({
                    Title = "é”™è¯¯", 
                    Content = errorMessage .. ": " .. tostring(err), 
                    Duration = 5,
                    Color = ColorSystem.errorColor
                })
            else
                warn(errorMessage .. ": " .. tostring(err))
            end
        end
        return success
    end
    
    -- å®½æ¾çš„WindUIåŠ è½½å‡½æ•°
    local function loadWindUISafe()
        local backupSources = {
            "https://raw.githubusercontent.com/Footagesus/WindUI/main/main.lua",
            "https://cdn.jsdelivr.net/gh/Footagesus/WindUI@main/main.lua"
        }
        
        -- é¦–å…ˆå°è¯•ä¸»è¦æº
        local mainSource = safeHttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua")
        if mainSource then
            local success, lib = pcall(loadstring(mainSource))
            if success and lib then
                return lib
            end
        end
        
        -- å¦‚æœä¸»è¦æºå¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æº
        for _, url in ipairs(backupSources) do
            local source = safeHttpGet(url)
            if source then
                local success, lib = pcall(loadstring(source))
                if success and lib then
                    return lib
                end
            end
        end
        
        -- å¦‚æœæ‰€æœ‰æºéƒ½å¤±è´¥ï¼Œå°è¯•ç›´æ¥åŠ è½½ï¼ˆé™çº§æ–¹æ¡ˆï¼‰
        warn("æ‰€æœ‰WindUIæºåŠ è½½å¤±è´¥ï¼Œå°è¯•é™çº§æ–¹æ¡ˆ")
        return nil, "æ— æ³•ä»ä»»ä½•æºåŠ è½½WindUIåº“"
    end
    
    -- å…¨å±€æœåŠ¡å¼•ç”¨
    local Players = game:GetService("Players")
    local Workspace = game:GetService("Workspace")
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")
    local ProximityPromptService = game:GetService("ProximityPromptService")

    -- æœ¬åœ°ç©å®¶å¼•ç”¨
    local LP = Players.LocalPlayer
    local Character = LP.Character or LP.CharacterAdded:Wait()

    -- å®¢æˆ·ç«¯æ¨¡å—
    local ClientModule
    local EatRemote
    local function GetClientModule()
        if not ClientModule then
            ClientModule = require(LP:WaitForChild("PlayerScripts"):WaitForChild("Client"))
            EatRemote = ClientModule and ClientModule.Events and ClientModule.Events.RequestConsumeItem
        end
        return ClientModule, EatRemote
    end

    -- åŠ è½½ WindUI åº“ï¼ˆå®½æ¾ç‰ˆæœ¬ï¼‰
    local WindUISuccess, WindUI = pcall(loadWindUISafe)

    if not WindUISuccess or not WindUI then
        local errMsg = "WindUI åŠ è½½å¤±è´¥: " .. tostring(WindUI)
        warn(errMsg)
        -- ä½¿ç”¨åŸºæœ¬é”™è¯¯æç¤º
        game:GetService("StarterGui"):SetCore("SendNotification", {
            Title = "åº“åŠ è½½å¤±è´¥",
            Text = "æ— æ³•åŠ è½½UIåº“ï¼Œè„šæœ¬æ— æ³•ç»§ç»­",
            Duration = 10
        })
        return
    end

    -- å®½æ¾çš„è„šæœ¬åŠ è½½å‡½æ•°
    local function safeLoadScript(url, scriptName)
        if not WindUI then 
            warn("WindUIæœªåˆå§‹åŒ–ï¼Œæ— æ³•åŠ è½½è„šæœ¬: " .. scriptName)
            return false, "WindUIæœªåˆå§‹åŒ–" 
        end
        
        WindUI:Notify({
            Title = "æç¤º", 
            Content = "æ­£åœ¨åŠ è½½ " .. scriptName .. "...", 
            Duration = 2,
            Color = ColorSystem.primaryColor
        })
        
        local success, result = pcall(function()
            -- å®½æ¾çš„URLæ£€æŸ¥
            if url and url ~= "" and not isValidURL(url) then
                warn("URLå®‰å…¨æ£€æŸ¥è­¦å‘Šï¼Œä½†ä»å°è¯•åŠ è½½: " .. url)
                -- ä¸é˜»æ­¢åŠ è½½ï¼Œåªè®°å½•è­¦å‘Š
            end
            
            local response = safeHttpGet(url)
            if not response then
                return false, "æ— æ³•è·å–è„šæœ¬å†…å®¹"
            end
            
            if #response < 10 then
                return false, "è„šæœ¬å†…å®¹è¿‡çŸ­"
            end
            
            -- å®½æ¾çš„ä»£ç å®‰å…¨æ£€æŸ¥
            local codeSafe, safeMsg = isCodeSafe(response)
            if not codeSafe then
                warn("ä»£ç å®‰å…¨æ£€æŸ¥è­¦å‘Š: " .. safeMsg)
                -- ä¸é˜»æ­¢åŠ è½½ï¼Œåªè®°å½•è­¦å‘Š
            end
            
            local loadedFunction, loadError = loadstring(response)
            if not loadedFunction then
                return false, "è„šæœ¬ç¼–è¯‘é”™è¯¯: " .. tostring(loadError)
            end
            
            -- åœ¨ä¿æŠ¤ç¯å¢ƒä¸­æ‰§è¡Œ
            local executeSuccess, executeError = pcall(loadedFunction)
            if not executeSuccess then
                return false, "è„šæœ¬æ‰§è¡Œé”™è¯¯: " .. tostring(executeError)
            end
            
            return true
        end)
        
        if success and result then
            WindUI:Notify({
                Title = "æˆåŠŸ", 
                Content = scriptName .. " åŠ è½½å®Œæˆ", 
                Duration = 3,
                Color = ColorSystem.successColor
            })
            return true
        else
            local errorMsg = success and result or "ç½‘ç»œè¯·æ±‚å¤±è´¥"
            WindUI:Notify({
                Title = "é”™è¯¯", 
                Content = scriptName .. " åŠ è½½å¤±è´¥: " .. errorMsg, 
                Duration = 5,
                Color = ColorSystem.errorColor
            })
            return false, errorMsg
        end
    end

    -- åˆ›å»ºä¸»çª—å£
    local Window = WindUI:CreateWindow({
        Title = "æœ¬ç†Šè„šæœ¬",
        IconThemed = true,
        Author = "ä½œè€…:æœ¬ç†Š",
        Folder = "æœ¬ç†Šè„šæœ¬",
        Size = UDim2.fromOffset(600, 500),
        Transparent = true,
        Theme = "Dark",
        User = {
            Enabled = true,
            Callback = function() 
                if safeSetClipboard("robloxæœ¬ç†Š") then
                    WindUI:Notify({
                        Title = "æç¤º", 
                        Content = "å·²å¤åˆ¶ä½œè€…ä¿¡æ¯", 
                        Duration = 2,
                        Color = ColorSystem.primaryColor
                    })
                else
                    WindUI:Notify({
                        Title = "é”™è¯¯", 
                        Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", 
                        Duration = 2,
                        Color = ColorSystem.errorColor
                    })
                end
            end,
            Anonymous = true
        },
        SideBarWidth = 220,
        ScrollBarEnabled = true,
        -- å¯†é’¥ç³»ç»Ÿé…ç½®
        KeySystem = {
            Key = {"ç§‹å®¹"},
            Note = "è°æ²¡ç›®è¿˜çˆ±åœˆé’±ï¼Ÿ",
            URL = "ç§‹å®¹",
            SaveKey = true,
            Theme = "Modern",
            Background = {
                Type = "Gradient",
                Color1 = Color3.fromRGB(0, 100, 200),
                Color2 = Color3.fromRGB(100, 0, 200)
            },
            InputPlaceholder = "è¯·è¾“å…¥å¯†é’¥...",
            ButtonText = "éªŒè¯å¯†é’¥",
            SuccessMessage = "å¯†é’¥éªŒè¯æˆåŠŸï¼æ¬¢è¿ä½¿ç”¨æœ¬ç†Šè„šæœ¬",
            ErrorMessage = "å¯†é’¥æ— æ•ˆï¼Œè¯·é‡è¯•",
            ShowHint = true,
            HintText = "è°æ²¡ç›®è¿˜çˆ±åœˆé’±ï¼Ÿ"
        }
    })
    
    Window:Tag({
        Title = "v1.7.4",
        Color = Color3.fromHex("#30ff6a")
    })
    
    Window:Tag({
        Title = "æ±‰åŒ–", 
        Color = Color3.fromHex("#315dff")
    })

    -- åˆ›å»ºå…¨å±æŒ‰é’®
    Window:CreateTopbarButton("å…¨å±", "battery-plus", function() 
        Window:ToggleFullscreen()
        WindUI:Notify({
            Title = "æç¤º", 
            Content = "åˆ‡æ¢å…¨å±æ¨¡å¼", 
            Duration = 2,
            Color = ColorSystem.primaryColor
        })
    end, 989)

    -- åˆ›å»ºæ ‡ç­¾é¡µ
    local Tabs = {
        Home = Window:Tab({ Title = "ä¸»é¡µ", Icon = "home" }),
        AutoTranslate = Window:Tab({ Title = "è‡ªåŠ¨æ±‰åŒ–", Icon = "languages" }),
        Man = Window:Tab({ Title = "é€šç”¨è„šæœ¬æ±‰åŒ–", Icon = "zap" }),
        Main = Window:Tab({ Title = "99å¤œè„šæœ¬æ±‰åŒ–", Icon = "zap" }),
        Ninja = Window:Tab({ Title = "æ­»é“è½¨è„šæœ¬æ±‰åŒ–", Icon = "user" }),
        Oth = Window:Tab({ Title = "å·èµ°è„‘çº¢è„šæœ¬æ±‰åŒ–", Icon = "heart" }),
        StrongBattlefield = Window:Tab({ Title = "æœ€å¼ºæˆ˜åœºè„šæœ¬æ±‰åŒ–", Icon = "target" }),
        Abandoned = Window:Tab({ Title = "è¢«é—å¼ƒè„šæœ¬æ±‰åŒ–", Icon = "ghost" }),
        General = Window:Tab({ Title = "é€šç”¨", Icon = "settings" }),
        FlyAndTeleport = Window:Tab({ Title = "ç”©é£ä¸ä¼ é€", Icon = "rocket" }),
        Other = Window:Tab({ Title = "å·¥å…·", Icon = "tool" })
    }

    -- é»˜è®¤é€‰æ‹©ä¸»é¡µ
    Window:SelectTab(1)

    -- ä¸»é¡µå†…å®¹
    Tabs.Home:Paragraph({
        Title = "robloxæœ¬ç†Š",
        Desc = "å¼€è„šæœ¬ä½ å°±å—ç€",
        Image = "https://raw.githubusercontent.com/jbu7666gvv/tu/d267405e769158957ab402e8a2ec9a5d019cf78b/hhbg.jpg",
        ImageSize = 42,
        Thumbnail = "https://raw.githubusercontent.com/jbu7666gvv/tu/d267405e769158957ab402e8a2ec9a5d019cf78b/hhbg.jpg",
        ThumbnailSize = 120
    })
    
    Tabs.Home:Paragraph({
        Title = "æ¬¢è¿ä½¿ç”¨æœ¬ç†Šè„šæœ¬",
        Desc = "",
    })

    Tabs.Home:Paragraph({
        Title = "æ›´æ–°å†…å®¹",
        Desc = "â€¢ æ”¾å®½å®‰å…¨æ£€æŸ¥\nâ€¢ ä¿®å¤å†…å®¹æ˜¾ç¤ºé—®é¢˜\nâ€¢ æ”¹è¿›é”™è¯¯å¤„ç†",
    })

    Tabs.Home:Section({Title = "ä¿¡æ¯"})

    Tabs.Home:Button({
        Title = "å¤åˆ¶QQç¾¤å·",
        Desc = "ç‚¹å‡»å¤åˆ¶QQç¾¤å·",
        Callback = function()
            if safeSetClipboard("1038615008") then
                WindUI:Notify({
                    Title = "æˆåŠŸ", 
                    Content = "QQç¾¤å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", 
                    Duration = 3,
                    Color = ColorSystem.successColor
                })
            else
                WindUI:Notify({
                    Title = "é”™è¯¯", 
                    Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", 
                    Duration = 3,
                    Color = ColorSystem.errorColor
                })
            end
        end
    })

    Tabs.Home:Button({
        Title = "å¤åˆ¶å¿«æ‰‹å·",
        Desc = "ç‚¹å‡»å¤åˆ¶å¿«æ‰‹å·",
        Callback = function()
            if safeSetClipboard("3460680158") then
                WindUI:Notify({
                    Title = "æˆåŠŸ", 
                    Content = "å¿«æ‰‹å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", 
                    Duration = 3,
                    Color = ColorSystem.successColor
                })
            else
                WindUI:Notify({
                    Title = "é”™è¯¯", 
                    Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", 
                    Duration = 3,
                    Color = ColorSystem.errorColor
                })
            end
        end
    })

    Tabs.Home:Button({
        Title = "å¤åˆ¶è€é¼ å¿«æ‰‹å·",
        Desc = "ç‚¹å‡»å¤åˆ¶å¿«æ‰‹å·",
        Callback = function()
            if safeSetClipboard("lousun7891") then
                WindUI:Notify({
                    Title = "æˆåŠŸ", 
                    Content = "å¿«æ‰‹å·å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", 
                    Duration = 3,
                    Color = ColorSystem.successColor
                })
            else
                WindUI:Notify({
                    Title = "é”™è¯¯", 
                    Content = "å‰ªè´´æ¿å¤åˆ¶å¤±è´¥", 
                    Duration = 3,
                    Color = ColorSystem.errorColor
                })
            end
        end
    })
    
    Tabs.Home:Section({Title = "ç©å®¶ä¿¡æ¯"})
    
    -- ä¿®å¤ç©å®¶ä¿¡æ¯éƒ¨åˆ†ï¼Œä½¿ç”¨ Tabs.Home è€Œä¸æ˜¯ TabHandles.xx
    Tabs.Home:Paragraph({
        Title = "æ‚¨çš„æ¸¸æˆåç§°ï¼š",
        Desc = ""..game:GetService("Players").LocalPlayer.DisplayName.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨çš„åç§°",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(game:GetService("Players").LocalPlayer.DisplayName)
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨çš„æ¸¸æˆç”¨æˆ·åï¼š",
        Desc = ""..game:GetService("Players").LocalPlayer.Name.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨çš„ç”¨æˆ·å",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(game:GetService("Players").LocalPlayer.Name)
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨çš„ç”¨æˆ·åIDï¼š",
        Desc = ""..game:GetService("Players").LocalPlayer.UserId.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨çš„ç”¨æˆ·åID",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(game:GetService("Players").LocalPlayer.UserId)
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨çš„è´¦å·æ³¨å†Œæ—¶é—´ï¼ˆå¤©ï¼‰ï¼š",
        Desc = ""..game:GetService("Players").LocalPlayer.AccountAge.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨çš„æ³¨å†Œæ—¶é—´",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(game:GetService("Players").LocalPlayer.AccountAge)
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨æ‰€åœ¨çš„æœåŠ¡å™¨åç§°ï¼š",
        Desc = ""..game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨æ‰€åœ¨çš„æœåŠ¡å™¨åç§°",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name)
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨æ‰€åœ¨çš„æœåŠ¡å™¨IDï¼š",
        Desc = ""..game.PlaceId.."",
        Buttons = {
            {
                Title = "å¤åˆ¶æ‚¨æ‰€åœ¨çš„æœåŠ¡å™¨ID",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(tostring(game.PlaceId))
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    Tabs.Home:Paragraph({
        Title = "æ‚¨çš„æ³¨å…¥å™¨ï¼š",
        Desc = ""..getExecutorName().."",
        Thumbnail = "rbxassetid://94512740386917",
        ThumbnailSize = 120,
        Buttons = {
            {
                Title = "å¤åˆ¶æ³¨å…¥å™¨åç§°",
                Icon = "copy",
                Variant = "Primary",
                Callback = function() 
                    setclipboard(getExecutorName())
                    local Sound = Instance.new("Sound",game:GetService("SoundService"))
                    Sound:Play()
                    WindUI:Notify({
                        Title = "æœ¬ç†Šè„šæœ¬",
                        Content = "å·²æˆåŠŸå¤åˆ¶ï¼",
                        Icon = "bell",
                        IconThemed = true,
                        Duration = 5,
                    })
                end
            }
        }
    })

    -- æœ€å¼ºæˆ˜åœºæ ‡ç­¾é¡µå†…å®¹
    Tabs.StrongBattlefield:Section({Title = "æœ€å¼ºæˆ˜åœºæ±‰åŒ–è„šæœ¬"})

    Tabs.StrongBattlefield:Button({
        Title = "TheDarkone's Empire(æ— å¡å¯†)",
        Desc = "æ±‰åŒ–",
        Callback = function()
            safeLoadScript("https://raw.githubusercontent.com/jbu7666gvv/hanh/refs/heads/main/TheDarkone's%20Empire", "TheDarkone's Empireè„šæœ¬")
        end
    })

    -- è¢«é—å¼ƒæ ‡ç­¾é¡µå†…å®¹
    Tabs.Abandoned:Section({Title = "è¢«é—å¼ƒæ±‰åŒ–è„šæœ¬"})

    Tabs.Abandoned:Button({
        Title = "Guesting Hub(æ— å¡å¯†)",
        Desc = "æ±‰åŒ–",
        Callback = function()
            safeLoadScript("https://raw.githubusercontent.com/jbu7666gvv/hanh/refs/heads/main/GuestingHub", "Guesting Hubè„šæœ¬")
        end
    })

    -- è‡ªåŠ¨æ±‰åŒ–è„šæœ¬å®šä¹‰
    local autoTranslateScripts = {
        {
            Title = "è‡ªåŠ¨æ±‰åŒ–",
            Desc = "ç”¨äºç»™ä¸€äº›æ²¡æ±‰åŒ–çš„è„šæœ¬æ±‰åŒ–ï¼Œåªèƒ½å¯¹å¸¸è§çš„è¿›è¡Œæ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/zihan/refs/heads/main/zihan",
            RequiresKey = true
        }
    }

    Tabs.AutoTranslate:Section({Title = "è‡ªåŠ¨æ±‰åŒ–"})

    for i, scriptInfo in ipairs(autoTranslateScripts) do
        Tabs.AutoTranslate:Button({
            Title = scriptInfo.Title,
            Desc = scriptInfo.Desc,
            Callback = function()
                safeLoadScript(scriptInfo.URL, scriptInfo.Title)
            end
        })
    end

    -- é€šç”¨è„šæœ¬æ±‰åŒ–éƒ¨åˆ†
    local manScripts = {
        {
            Title = "æ— æ•Œå°‘ä¾ é£è¡Œè„šæœ¬(æ— å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/jianhan/refs/heads/main/2",
            RequiresKey = true
        }
    }

    Tabs.Man:Section({Title = "é€šç”¨è„šæœ¬æ±‰åŒ–"})

    for i, scriptInfo in ipairs(manScripts) do
        Tabs.Man:Button({
            Title = scriptInfo.Title,
            Desc = scriptInfo.Desc,
            Callback = function()
                safeLoadScript(scriptInfo.URL, scriptInfo.Title)
            end
        })
    end

    -- 99å¤œè„šæœ¬å®šä¹‰
    local mainScripts = {
        {
            Title = "h4x (è¦å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/h4x6/refs/heads/main/h4x%E6%B1%89%E5%8C%96",
            RequiresKey = true
        },
        {
            Title = "è™šç©º (æ— å¡å¯†)", 
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/xuu/refs/heads/main/xuu",
            RequiresKey = false
        },
        {
            Title = "ToastyXD Hub (è¦å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/toastyxdhub/refs/heads/main/toastyxdhub",
            RequiresKey = true
        },
        {
            Title = "LunorLounge (è¦å¡å¯†)",
            Desc = "åŠæ±‰åŒ– - å·²åœæ­¢æ›´æ–°",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/LunorLounge/refs/heads/main/LunorLounge",
            RequiresKey = true
        },
        {
            Title = "CpsHub (æ— å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/CpsHub/refs/heads/main/CpsHub",
            RequiresKey = true
        },
        {
            Title = "VEX OP(æ— å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/quanhan/refs/heads/main/VEXOP",
            RequiresKey = true
        },
        {
            Title = "Rayfield(æ— å¡å¯†)",
            Desc = "æ±‰åŒ–",
            URL = "https://raw.githubusercontent.com/jbu7666gvv/hanh/refs/heads/main/Rayfield",
            RequiresKey = true
        }
    }

    Tabs.Main:Section({Title = "99å¤œæ±‰åŒ–è„šæœ¬"})

    for i, scriptInfo in ipairs(mainScripts) do
        Tabs.Main:Button({
            Title = scriptInfo.Title,
            Desc = scriptInfo.Desc,
            Callback = function()
                safeLoadScript(scriptInfo.URL, scriptInfo.Title)
            end
        })
    end

    Tabs.Ninja:Section({Title = "æ­»é“è½¨æ±‰åŒ–è„šæœ¬"})

    Tabs.Ninja:Button({
        Title = "RINGTA (æ— å¡å¯†)",
        Desc = "æ±‰åŒ–",
        Callback = function()
            safeLoadScript("https://raw.githubusercontent.com/jbu7666gvv/ringtasi/main/ringtasi", "RINGTAè„šæœ¬")
        end
    })

-- é€šç”¨åŠŸèƒ½éƒ¨åˆ†
Tabs.General:Section({Title = "é€šç”¨åŠŸèƒ½"})

Tabs.General:Slider({
    Title = "ç§»é€Ÿ",
    Value = {
        Min = 16,
        Max = 500,
        Default = 16,
    },
    Increment = 1,
    Callback = function(value)
        safeCall(function()
            local Plr = game.Players.LocalPlayer
            if Plr.Character then
                local Humanoid = Plr.Character:FindFirstChildOfClass("Humanoid")
                if Humanoid then
                    Humanoid.WalkSpeed = value
                end
            end
        end, "è®¾ç½®ç§»é€Ÿ")
    end
})

Tabs.General:Slider({
    Title = "è·³è·ƒ",
    Value = {
        Min = 50,
        Max = 200,
        Default = 50,
    },
    Increment = 1,
    Callback = function(value)
        safeCall(function()
            if game.Players.LocalPlayer.Character then
                local humanoid = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Humanoid")
                if humanoid then
                    humanoid.JumpPower = value
                end
            end
        end, "è®¾ç½®è·³è·ƒ")
    end
})

Tabs.General:Slider({
    Title = "é‡åŠ›",
    Value = {
        Min = 0.1,
        Max = 500.0,
        Default = 196.2,
    },
    Step = 0.1,
    Callback = function(value)
        safeCall(function()
            game.Workspace.Gravity = value
        end, "è®¾ç½®é‡åŠ›")
    end
})

local Noclip = false
local NoclipConnection
Tabs.General:Toggle({
    Title = "ç©¿å¢™",
    Value = false,
    Callback = function(state)
        safeCall(function()
            if state then
                Noclip = true
                if NoclipConnection then
                    NoclipConnection:Disconnect()
                end
                NoclipConnection = game:GetService("RunService").Stepped:Connect(function()
                    if Noclip and game.Players.LocalPlayer.Character then
                        for _, part in pairs(game.Players.LocalPlayer.Character:GetDescendants()) do
                            if part:IsA("BasePart") then
                                part.CanCollide = false
                            end
                        end
                    end
                end)
            else
                Noclip = false
                if NoclipConnection then
                    NoclipConnection:Disconnect()
                    NoclipConnection = nil
                end
            end
        end, "åˆ‡æ¢ç©¿å¢™")
    end
})

Tabs.General:Toggle({
    Title = "å¤œè§†",
    Desc = "å¼€å¯/å…³é—­å¤œè§†",
    Default = false,
    Callback = function(value)
        safeCall(function()
            if value then
                game.Lighting.Ambient = Color3.new(1, 1, 1)
                game.Lighting.Brightness = 1
            else
                game.Lighting.Ambient = Color3.new(0, 0, 0)
                game.Lighting.Brightness = 1
            end
        end, "åˆ‡æ¢å¤œè§†")
    end
})

local fogRemoved = false

-- ç›‘å¬ Lighting å˜åŒ–
game.Lighting:GetPropertyChangedSignal("FogEnd"):Connect(function()
    if fogRemoved then
        game.Lighting.FogEnd = 999999
    end
end)

game.Lighting:GetPropertyChangedSignal("FogStart"):Connect(function()
    if fogRemoved then
        game.Lighting.FogStart = 999999
    end
end)

Tabs.General:Toggle({
    Title = "å»é›¾",
    Desc = "ä¸€é”®å»é™¤/æ¢å¤æ¸¸æˆä¸­çš„é›¾",
    Icon = "bell",
    Callback = function(State)
        fogRemoved = State
        
        if State then
            game.Lighting.FogEnd = 999999
            game.Lighting.FogStart = 999999
            game.Lighting.FogEnabled = false
            WindUI:Notify({Title = "æœ¬ç†Šè„šæœ¬", Content = "å·²å»é›¾", Icon = "bell", Duration = 3})
        else
            game.Lighting.FogEnabled = true
            WindUI:Notify({Title = "æœ¬ç†Šè„šæœ¬", Content = "å·²æ¢å¤é›¾æ•ˆ", Icon = "bell", Duration = 3})
        end
    end
})

Tabs.General:Slider({
    Title = "ä¼¤å®³å€æ•°",
    Value = {
        Min = 1,
        Max = 10,
        Default = 1,
    },
    Increment = 1,
    Callback = function(value)
        WindUI:Notify({
            Title = "è®¾ç½®", 
            Content = "ä¼¤å®³å€æ•°è®¾ç½®ä¸º: " .. tostring(value), 
            Duration = 2,
            Color = ColorSystem.primaryColor
        })
    end
})

Tabs.General:Toggle({
    Title = "å…¶ä»–ç©å®¶å‘å…‰",
    Icon = "users",
    Callback = function(t)
        -- å°†å˜é‡ç§»åˆ°å›è°ƒå‡½æ•°å¤–éƒ¨ï¼Œä½¿å…¶åœ¨å¤šæ¬¡è°ƒç”¨é—´ä¿æŒçŠ¶æ€
        if not _G.PlayerGlowData then
            _G.PlayerGlowData = {
                playerLights = {},
                connections = {}
            }
        end
        
        local data = _G.PlayerGlowData
        
        if t then
            -- å¼€å¯å…¶ä»–ç©å®¶å‘å…‰
            WindUI:Notify({
                Title = "æç¤º",
                Content = "å…¶ä»–ç©å®¶å‘å…‰å·²å¼€å¯",
                Duration = 2,
                Color = ColorSystem.successColor
            })
            
            -- ç»™ç©å®¶æ·»åŠ å‘å…‰æ•ˆæœçš„å‡½æ•°
            local function addGlowToPlayer(player)
                if player == LP then return end -- è·³è¿‡è‡ªå·±
                
                -- å¦‚æœå·²ç»å­˜åœ¨ç¯å…‰ï¼Œå…ˆç§»é™¤
                if data.playerLights[player] then
                    for _, light in ipairs(data.playerLights[player]) do
                        pcall(function() light:Destroy() end)
                    end
                end
                data.playerLights[player] = {}
                
                local function setupCharacter(character)
                    -- ç§»é™¤å¯èƒ½å­˜åœ¨çš„æ—§ç¯å…‰
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") then
                            local light = part:FindFirstChild("PlayerGlowLight")
                            if light then
                                light:Destroy()
                            end
                        end
                    end
                    
                    -- ç»™è§’è‰²çš„æ‰€æœ‰BasePartæ·»åŠ ç¯å…‰
                    for _, part in pairs(character:GetDescendants()) do
                        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
                            local light = Instance.new("PointLight")
                            light.Name = "PlayerGlowLight"
                            light.Range = 8
                            light.Brightness = 2
                            light.Color = Color3.fromRGB(0, 255, 255) -- é’è‰²å…‰
                            light.Shadows = false
                            light.Parent = part
                            
                            table.insert(data.playerLights[player], light)
                        end
                    end
                    
                    -- ç»™äººå½¢æ ¹éƒ¨ä½æ·»åŠ æ›´å¼ºçš„ç¯å…‰
                    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                    if humanoidRootPart then
                        local mainLight = Instance.new("PointLight")
                        mainLight.Name = "PlayerGlowLight"
                        mainLight.Range = 15
                        mainLight.Brightness = 3
                        mainLight.Color = Color3.fromRGB(255, 255, 0) -- é»„è‰²ä¸»å…‰
                        mainLight.Shadows = false
                        mainLight.Parent = humanoidRootPart
                        
                        table.insert(data.playerLights[player], mainLight)
                    end
                end
                
                local character = player.Character
                if character then
                    setupCharacter(character)
                end
                
                -- ç›‘å¬è§’è‰²é‡æ–°ç”Ÿæˆï¼ˆåªåœ¨åŠŸèƒ½å¼€å¯æ—¶æœ‰æ•ˆï¼‰
                local characterConnection = player.CharacterAdded:Connect(function(newChar)
                    task.wait(1)
                    if t then -- æ£€æŸ¥åŠŸèƒ½æ˜¯å¦ä»ç„¶å¼€å¯
                        setupCharacter(newChar)
                    end
                end)
                
                -- ä¿å­˜è¿æ¥ä»¥ä¾¿æ¸…ç†
                data.connections[player] = characterConnection
            end
            
            -- ç»™æ‰€æœ‰ç°æœ‰ç©å®¶æ·»åŠ å‘å…‰
            for _, player in pairs(Players:GetPlayers()) do
                if player ~= LP then
                    addGlowToPlayer(player)
                end
            end
            
            -- ç›‘å¬æ–°ç©å®¶åŠ å…¥
            data.connections.playerAdded = Players.PlayerAdded:Connect(function(player)
                task.wait(2) -- ç­‰å¾…ç©å®¶åŠ è½½
                if t then -- æ£€æŸ¥åŠŸèƒ½æ˜¯å¦ä»ç„¶å¼€å¯
                    addGlowToPlayer(player)
                end
            end)
            
            -- ç›‘å¬ç©å®¶ç¦»å¼€
            data.connections.playerRemoving = Players.PlayerRemoving:Connect(function(player)
                if data.playerLights[player] then
                    for _, light in ipairs(data.playerLights[player]) do
                        pcall(function() light:Destroy() end)
                    end
                    data.playerLights[player] = nil
                end
                if data.connections[player] then
                    data.connections[player]:Disconnect()
                    data.connections[player] = nil
                end
            end)
            
        else
            -- å…³é—­å…¶ä»–ç©å®¶å‘å…‰
            WindUI:Notify({
                Title = "æç¤º",
                Content = "å…¶ä»–ç©å®¶å‘å…‰å·²å…³é—­",
                Duration = 2,
                Color = ColorSystem.primaryColor
            })
            
            -- ç§»é™¤æ‰€æœ‰ç©å®¶çš„ç¯å…‰
            for player, lights in pairs(data.playerLights) do
                if player and lights then
                    for _, light in ipairs(lights) do
                        pcall(function() light:Destroy() end)
                    end
                end
            end
            
            -- æ–­å¼€æ‰€æœ‰è¿æ¥
            for key, connection in pairs(data.connections) do
                if connection then
                    connection:Disconnect()
                end
            end
            
            -- é‡ç½®æ•°æ®
            data.playerLights = {}
            data.connections = {}
        end
    end
})

Tabs.General:Button({
    Title = "æ­»äº¡ç¬”è®°",
    Desc = "åŠ è½½æ­»äº¡ç¬”è®°è„šæœ¬",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/dingding123hhh/tt/main/%E6%AD%BB%E4%BA%A1%E7%AC%94%E8%AE%B0%20(1).txt", "æ­»äº¡ç¬”è®°è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "è¸ç©º",
    Desc = "åŠ è½½è¸ç©ºè„šæœ¬",
    Callback = function()
        safeLoadScript('https://raw.githubusercontent.com/GhostPlayer352/Test4/main/Float', "è¸ç©ºè„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "æ— é™è·³",
    Desc = "åŠ è½½æ— é™è·³è„šæœ¬",
    Callback = function()
        safeLoadScript("https://pastebin.com/raw/V5PQy3y0", "æ— é™è·³è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "æ˜¾ç¤ºFPS",
    Desc = "æ˜¾ç¤ºFPSè®¡æ•°å™¨",
    Callback = function()
        safeLoadScript("https://pastefy.app/d9j82YJr/raw", "FPSæ˜¾ç¤ºè„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "ç©å®¶è¿›å…¥æç¤º",
    Desc = "ç©å®¶è¿›å…¥æ¸¸æˆæç¤º",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/boyscp/scriscriptsc/main/bbn.lua", "ç©å®¶æç¤ºè„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "ç”µè„‘é”®ç›˜",
    Desc = "è™šæ‹Ÿç”µè„‘é”®ç›˜",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/advxzivhsjjdhxhsidifvsh/mobkeyboard/main/main.txt", "è™šæ‹Ÿé”®ç›˜è„šæœ¬")
    end
})

Tabs.General:Section({Title = "å…‰å½±ä¸ç”»è´¨"})

Tabs.General:Button({
    Title = "å…‰å½±",
    Desc = "åŠ è½½å…‰å½±æ•ˆæœ",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/MZEEN2424/Graphics/main/Graphics.xml", "å…‰å½±è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "å…‰å½±2",
    Desc = "åŠ è½½ç¬¬äºŒç§å…‰å½±æ•ˆæœ",
    Callback = function()
        safeCall(function()
            -- Roblox Graphics Enhancher
            local light = game.Lighting
            for i, v in pairs(light:GetChildren()) do
                v:Destroy()
            end

            local ter = workspace.Terrain
            local color = Instance.new("ColorCorrectionEffect")
            local bloom = Instance.new("BloomEffect")
            local sun = Instance.new("SunRaysEffect")
            local blur = Instance.new("BlurEffect")

            color.Parent = light
            bloom.Parent = light
            sun.Parent = light
            blur.Parent = light

            -- enable or disable shit
            local config = {
                Terrain = true;
                ColorCorrection = true;
                Sun = true;
                Lighting = true;
                BloomEffect = true;
            }

            -- settings {
            color.Enabled = false
            color.Contrast = 0.15
            color.Brightness = 0.1
            color.Saturation = 0.25
            color.TintColor = Color3.fromRGB(255, 222, 211)

            bloom.Enabled = false
            bloom.Intensity = 0.1

            sun.Enabled = false
            sun.Intensity = 0.2
            sun.Spread = 1

            bloom.Enabled = false
            bloom.Intensity = 0.05
            bloom.Size = 32
            bloom.Threshold = 1

            blur.Enabled = false
            blur.Size = 6

            -- settings }

            if config.ColorCorrection then
                color.Enabled = true
            end

            if config.Sun then
                sun.Enabled = true
            end

            if config.Terrain then
                -- settings {
                ter.WaterWaveSize = 0.1
                ter.WaterWaveSpeed = 22
                ter.WaterTransparency = 0.9
                ter.WaterReflectance = 0.05
                -- settings }
            end
            if config.Lighting then
                -- settings {
                light.Ambient = Color3.fromRGB(0, 0, 0)
                light.Brightness = 4
                light.ColorShift_Bottom = Color3.fromRGB(0, 0, 0)
                light.ColorShift_Top = Color3.fromRGB(0, 0, 0)
                light.ExposureCompensation = 0
                light.FogColor = Color3.fromRGB(132, 132, 132)
                light.GlobalShadows = true
                light.OutdoorAmbient = Color3.fromRGB(112, 117, 128)
                light.Outlines = false
                -- settings }
            end
            local a = game.Lighting
            a.Ambient = Color3.fromRGB(33, 33, 33)
            a.Brightness = 5.69
            a.ColorShift_Bottom = Color3.fromRGB(0, 0, 0)
            a.ColorShift_Top = Color3.fromRGB(255, 247, 237)
            a.EnvironmentDiffuseScale = 0.105
            a.EnvironmentSpecularScale = 0.522
            a.GlobalShadows = true
            a.OutdoorAmbient = Color3.fromRGB(51, 54, 67)
            a.ShadowSoftness = 0.18
            a.GeographicLatitude = -15.525
            a.ExposureCompensation = 0.75
            bloom.Enabled = true
            bloom.Intensity = 0.99
            bloom.Size = 9999 
            bloom.Threshold = 0
            local c = Instance.new("ColorCorrectionEffect", a)
            c.Brightness = 0.015
            c.Contrast = 0.25
            c.Enabled = true
            c.Saturation = 0.2
            c.TintColor = Color3.fromRGB(217, 145, 57)
            
            local d = Instance.new("DepthOfFieldEffect", a)
            d.Enabled = true
            d.FarIntensity = 0.077
            d.FocusDistance = 21.54
            d.InFocusRadius = 20.77
            d.NearIntensity = 0.277
            local e = Instance.new("ColorCorrectionEffect", a)
            e.Brightness = 0
            e.Contrast = -0.07
            e.Saturation = 0
            e.Enabled = true
            e.TintColor = Color3.fromRGB(255, 247, 239)
            local e2 = Instance.new("ColorCorrectionEffect", a)
            e2.Brightness = 0.2
            e2.Contrast = 0.45
            e2.Saturation = -0.1
            e2.Enabled = true
            e2.TintColor = Color3.fromRGB(255, 255, 255)
            local s = Instance.new("SunRaysEffect", a)
            s.Enabled = true
            s.Intensity = 0.01
            s.Spread = 0.146

            WindUI:Notify({
                Title = "æˆåŠŸ",
                Content = "RTX Graphics loaded! Created by BrickoIcko",
                Duration = 3,
                Color = ColorSystem.successColor
            })
        end, "åŠ è½½å…‰å½±2")
    end
})

Tabs.General:Button({
    Title = "ç”»è´¨",
    Desc = "æå‡æ¸¸æˆç”»è´¨",
    Callback = function()
        safeLoadScript("https://pastebin.com/raw/jHBfJYmS", "ç”»è´¨æå‡è„šæœ¬")
    end
})

Tabs.General:Section({Title = "18ç¦ç”¨"})

Tabs.General:Button({
    Title = "æ’¸ç®¡R6",
    Desc = "R6è§’è‰²åŠ¨ç”»",
    Callback = function()
        safeLoadScript("https://pastefy.app/wa3v2Vgm/raw", "R6åŠ¨ç”»è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "æ’¸ç®¡R15",
    Desc = "R15è§’è‰²åŠ¨ç”»",
    Callback = function()
        safeLoadScript("https://pastefy.app/YZoglOyJ/raw", "R15åŠ¨ç”»è„šæœ¬")
    end
})

Tabs.General:Section({Title = "é£è¡ŒåŒº"})

Tabs.General:Button({
    Title = "é£è¡Œ",
    Desc = "é£è¡Œè„šæœ¬",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/XNEOFF/FlyGuiV3/main/FlyGuiV3.txt", "é£è¡Œè„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "é£è½¦",
    Desc = "é£è½¦è„šæœ¬",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/dingding123hhh/vb/main/%E9%A3%9E%E8%BD%A6.lua", "é£è½¦è„šæœ¬")
    end
})

Tabs.General:Section({Title = "ç”©é£åŒº"})

Tabs.General:Button({
    Title = "é“æ‹³",
    Desc = "é“æ‹³ç”©é£è„šæœ¬",
    Callback = function()
        safeLoadScript('https://raw.githubusercontent.com/0Ben1/fe/main/obf_rf6iQURzu1fqrytcnLBAvW34C9N55kS9g9G3CKz086rC47M6632sEd4ZZYB0AYgV.lua.txt', "é“æ‹³ç”©é£è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "æ—‹è½¬ç”©é£",
    Desc = "æ—‹è½¬ç”©é£è„šæœ¬",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/dingding123hhh/tt/main/%E6%97%8B%E8%BD%AC.lua", "æ—‹è½¬ç”©é£è„šæœ¬")
    end
})

Tabs.General:Button({
    Title = "ç¢°åˆ°å°±é£",
    Desc = "æ¥è§¦ç”©é£è„šæœ¬",
    Callback = function()
        safeLoadScript("https://raw.githubusercontent.com/0Ben1/fe./main/Fling%20GUI", "æ¥è§¦ç”©é£è„šæœ¬")
    end
})

-- ç”©é£ä¸ä¼ é€æ ‡ç­¾é¡µ
Tabs.FlyAndTeleport:Section({Title = "ç”©é£åŠŸèƒ½"})

Tabs.FlyAndTeleport:Button({
    Title = "æŒ‡å®šç”©é£(ç®€æ˜“ç‰ˆ)",
    Desc = "æŒ‡å®šç›®æ ‡ç”©é£",
    Callback = function()
        safeLoadScript('https://pastefy.app/9SmQXduA/raw', "æŒ‡å®šç”©é£è„šæœ¬")
    end
})

Tabs.FlyAndTeleport:Button({
    Title = "å…¨å›¾ç”©é£",
    Desc = "å…¨å›¾èŒƒå›´ç”©é£",
    Callback = function()
        safeLoadScript("https://pastebin.com/raw/zqyDSUWX", "å…¨å›¾ç”©é£è„šæœ¬")
    end
})

Tabs.FlyAndTeleport:Section({Title = "ä¼ é€åŠŸèƒ½"})

Tabs.FlyAndTeleport:Button({
    Title = "ä¼ é€åˆ°ç©å®¶",
    Desc = "é€‰æ‹©ç©å®¶å¹¶ä¼ é€",
    Callback = function()
        safeCall(function()
            local players = game:GetService("Players"):GetPlayers()
            local playerNames = {}
            for _, player in ipairs(players) do
                if player ~= game.Players.LocalPlayer then
                    table.insert(playerNames, player.Name)
                end
            end
            
            if #playerNames == 0 then
                WindUI:Notify({
                    Title = "é”™è¯¯",
                    Content = "æ²¡æœ‰å…¶ä»–ç©å®¶å¯ä¼ é€",
                    Duration = 3,
                    Color = ColorSystem.errorColor
                })
                return
            end
            
            -- è¿™é‡Œå¯ä»¥æ·»åŠ ç©å®¶é€‰æ‹©ç•Œé¢
            WindUI:Notify({
                Title = "æç¤º",
                Content = "ä¼ é€åŠŸèƒ½éœ€è¦é€‰æ‹©ç›®æ ‡ç©å®¶",
                Duration = 3,
                Color = ColorSystem.primaryColor
            })
        end, "ä¼ é€åŠŸèƒ½")
    end
})

Tabs.FlyAndTeleport:Button({
    Title = "ä¼ é€åˆ°åœ°ç‚¹",
    Desc = "ä¼ é€åˆ°æŒ‡å®šåæ ‡",
    Callback = function()
        safeCall(function()
            local character = game.Players.LocalPlayer.Character
            if character then
                local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                if humanoidRootPart then
                    humanoidRootPart.CFrame = CFrame.new(0, 100, 0)
                    WindUI:Notify({
                        Title = "æˆåŠŸ",
                        Content = "å·²ä¼ é€åˆ°ç©ºä¸­",
                        Duration = 3,
                        Color = ColorSystem.successColor
                    })
                end
            end
        end, "ä¼ é€åˆ°åœ°ç‚¹")
    end
})

    Tabs.Oth:Section({Title = "å·èµ°è„‘çº¢æ±‰åŒ–è„šæœ¬"})

    Tabs.Oth:Button({
        Title = "MIRANDA HUB (æ— å¡å¯†)",
        Desc = "æ±‰åŒ–",
        Callback = function()
            WindUI:Notify({
                Title = "æç¤º", 
                Content = "æ­£åœ¨åŠ è½½è„šæœ¬...", 
                Duration = 2,
                Color = ColorSystem.primaryColor
            })
            safeLoadScript("https://raw.githubusercontent.com/jbu7666gvv/jianhan/refs/heads/main/1", "MIRANDA HUBè„šæœ¬")
        end
    })

    -- å·¥å…·é¡µé¢
    Tabs.Other:Section({Title = "ç³»ç»Ÿå·¥å…·"})

    Tabs.Other:Button({
        Title = "é‡æ–°åŠ è½½ç•Œé¢",
        Desc = "é‡æ–°åŠ è½½ç”¨æˆ·ç•Œé¢",
        Callback = function()
            WindUI:Notify({
                Title = "æç¤º", 
                Content = "é‡æ–°åŠ è½½ç•Œé¢ä¸­...", 
                Duration = 2,
                Color = ColorSystem.primaryColor
            })
            
            -- ä¿å­˜é‡è¦ä¿¡æ¯
            local savedData = {
                keySystemEnabled = Window.KeySystem and true or false,
                key = Window.KeySystem and Window.KeySystem.Key or nil
            }
            
            -- å»¶è¿Ÿæ‰§è¡Œä»¥ç¡®ä¿é€šçŸ¥æ˜¾ç¤º
            task_wait(1)
            
            -- å®Œå…¨æ¸…ç†UI
            if Window then
                pcall(function() Window:Destroy() end)
                Window = nil
            end
            
            -- å¼ºåˆ¶åƒåœ¾å›æ”¶
            for i = 1, 5 do
                task_wait(0.1)
                collectgarbage("collect")
            end
            
            -- ä½¿ç”¨æ¸¸æˆçš„é‡ç½®åŠŸèƒ½
            if game:GetService("CoreGui"):FindFirstChild("WindUI") then
                game:GetService("CoreGui").WindUI:Destroy()
            end
            
            -- é‡æ–°æ‰§è¡Œè„šæœ¬çš„æ›¿ä»£æ–¹æ¡ˆ
            task_wait(0.5)
            
            -- æ–¹æ³•1ï¼šå°è¯•é€šè¿‡é‡æ–°è·å–è„šæœ¬æ¥é‡å¯
            local success, result = pcall(function()
                local restartScript = httpGet("https://raw.githubusercontent.com/jbu7666gvv/benhan/main/benhan.lua")
                if restartScript then
                    -- åˆ›å»ºæ–°çš„è„šæœ¬æ¥æ‰§è¡Œ
                    local newScript = Instance.new("LocalScript")
                    newScript.Source = restartScript
                    newScript.Parent = game:GetService("Players").LocalPlayer:WaitForChild("PlayerScripts")
                else
                    error("æ— æ³•è·å–é‡å¯è„šæœ¬")
                end
            end)
            
            if not success then
                -- æ–¹æ³•2ï¼šç®€å•çš„é‡æ–°åˆå§‹åŒ–
                WindUI:Notify({
                    Title = "é”™è¯¯", 
                    Content = "å®Œå…¨é‡å¯å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é‡æ–°æ‰§è¡Œè„šæœ¬", 
                    Duration = 5,
                    Color = ColorSystem.errorColor
                })
            end
        end
    })

    Tabs.Other:Button({
        Title = "æ¸…ç†ç¼“å­˜",
        Desc = "æ¸…ç†ç³»ç»Ÿç¼“å­˜",
        Callback = function()
            collectgarbage("collect")
            WindUI:Notify({
                Title = "æˆåŠŸ", 
                Content = "ç³»ç»Ÿç¼“å­˜å·²æ¸…ç†", 
                Duration = 3,
                Color = ColorSystem.successColor
            })
        end
    })
    
    Tabs.Other:Button({
    Title = "åˆ‡æ¢æœåŠ¡å™¨",
    Desc = "åˆ‡æ¢åˆ°ç›¸åŒæ¸¸æˆçš„å¦ä¸€ä¸ªæœåŠ¡å™¨",
    Callback = function()
        local TeleportService = game:GetService("TeleportService")
        local placeId = game.PlaceId
        
        TeleportService:Teleport(placeId, game.Players.LocalPlayer)
    end
})

Tabs.Other:Button({
    Title = "é‡æ–°åŠ å…¥æœåŠ¡å™¨",
    Desc = "å°è¯•é‡æ–°åŠ å…¥å½“å‰æœåŠ¡å™¨",
    Callback = function()
        local TeleportService = game:GetService("TeleportService")
        local placeId = game.PlaceId
        local jobId = game.JobId
        
        TeleportService:TeleportToPlaceInstance(placeId, jobId, game.Players.LocalPlayer)
    end
})

Tabs.Other:Button({
    Title = "å¤åˆ¶æœåŠ¡å™¨é‚€è¯·é“¾æ¥",
    Desc = "å¤åˆ¶å½“å‰æœåŠ¡å™¨çš„é‚€è¯·é“¾æ¥åˆ°å‰ªè´´æ¿",
    Callback = function()
        local inviteLink = "roblox://experiences/start?placeId=" .. game.PlaceId .. "&gameInstanceId=" .. game.JobId
        setclipboard(inviteLink)
        WindUI:Notify({
            Title = "é‚€è¯·é“¾æ¥å·²å¤åˆ¶",
            Content = "é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿",
            Duration = 3
        })
    end
})

Tabs.Other:Button({
    Title = "å¤åˆ¶æœåŠ¡å™¨ID",
    Desc = "å¤åˆ¶å½“å‰æœåŠ¡å™¨çš„Job IDåˆ°å‰ªè´´æ¿",
    Callback = function()
        setclipboard(game.JobId)
        WindUI:Notify({
            Title = "æœåŠ¡å™¨IDå·²å¤åˆ¶",
            Content = "Job ID: " .. game.JobId,
            Duration = 3
        })
    end
})


Tabs.Other:Button({
    Title = "æœåŠ¡å™¨ä¿¡æ¯",
    Desc = "æ˜¾ç¤ºå½“å‰æœåŠ¡å™¨çš„ä¿¡æ¯",
    Callback = function()
        local players = game.Players:GetPlayers()
        local maxPlayers = game.Players.MaxPlayers
        local placeId = game.PlaceId
        local jobId = game.JobId
        local serverType = game:GetService("RunService"):IsStudio() and "Studio" or "Live"
        
        WindUI:Notify({
            Title = "æœåŠ¡å™¨ä¿¡æ¯",
            Content = string.format("ç©å®¶æ•°é‡: %d/%d\nPlace ID: %d\nJob ID: %s\næœåŠ¡å™¨ç±»å‹: %s", #players, maxPlayers, placeId, jobId, serverType),
            Duration = 10
        })
    end
})

Tabs.Other:Slider({
    Title = "é€æ˜åº¦",
    Value = {
        Min = 0,
        Max = 1,
        Default = 0.2
    },
    Step = 0.1,
    Callback = function(value)
        Window:ToggleTransparency(tonumber(value) > 0)
        WindUI.TransparencyValue = tonumber(value)
    end
})

    -- å®Œæˆé€šçŸ¥
    WindUI:Notify({
        Title = "æœ¬ç†Šè„šæœ¬", 
        Content = "ç•Œé¢åŠ è½½å®Œæˆï¼", 
        Duration = 4,
        Color = ColorSystem.successColor
    })

end, enhancedErrorHandler)

if not success then
    enhancedErrorHandler(err)
end

-- åœ¨ enhancedErrorHandler å‡½æ•°ä¹‹åæ·»åŠ åæŠ“åŒ…ä¿æŠ¤çš„çŠ¶æ€ç›‘æ§
task.spawn(function()
    while true do
        wait(60) -- æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡ä¿æŠ¤çŠ¶æ€
        if Tabs and Tabs.Other then
            -- æ›´æ–°é˜»æ­¢è¯·æ±‚è®¡æ•°æ˜¾ç¤º
            for _, element in pairs(Tabs.Other.Elements or {}) do
                if element and element.Title == "é˜»æ­¢è¯·æ±‚" then
                    pcall(function()
                        element:SetDesc("å·²é˜»æ­¢: " .. tostring(AntiSpySystem.BlockedRequests) .. " ä¸ªè¯·æ±‚")
                    end)
                end
            end
        end
    end
end)

-- å¢å¼ºçš„å®‰å…¨é€šçŸ¥åŠŸèƒ½
local function securityAlert(alertType, details)
    local alertMessages = {
        monitoring_detected = "æ£€æµ‹åˆ°ç½‘ç»œç›‘æ§è½¯ä»¶",
        traffic_intercepted = "ç½‘ç»œæµé‡è¢«æ‹¦æˆª",
        ssl_anomaly = "SSLè¯ä¹¦å¼‚å¸¸",
        request_tampered = "è¯·æ±‚æ•°æ®è¢«ç¯¡æ”¹"
    }
    
    local message = alertMessages[alertType] or "å®‰å…¨å¨èƒæ£€æµ‹"
    if details then
        message = message .. ": " .. details
    end
    
    warn("[å®‰å…¨è­¦æŠ¥] " .. message)
    
    if WindUI then
        WindUI:Notify({
            Title = "å®‰å…¨è­¦æŠ¥",
            Content = message,
            Duration = 8,
            Color = Color3.fromRGB(255, 50, 50)
        })
    end
end

-- ç½‘ç»œè¯·æ±‚æ—¥å¿—è®°å½•ï¼ˆç”¨äºè°ƒè¯•ï¼‰
local requestLog = {}
local function logHttpRequest(url, success, responseLength)
    table.insert(requestLog, {
        time = os.time(),
        url = url,
        success = success,
        length = responseLength or 0
    })
    
    -- åªä¿ç•™æœ€è¿‘50æ¡è®°å½•
    if #requestLog > 50 then
        table.remove(requestLog, 1)
    end
end

-- å¢å¼ºçš„HTTPç›‘æ§
local originalHttpGet = game.HttpGet
game.HttpGet = function(url, ...)
    local startTime = os.clock()
    local success, result = pcall(function()
        return originalHttpGet(url, ...)
    end)
    
    local endTime = os.clock()
    local responseTime = endTime - startTime
    
    -- è®°å½•è¯·æ±‚
    logHttpRequest(url, success, success and #result or 0)
    
    -- æ£€æµ‹å¼‚å¸¸å“åº”æ—¶é—´
    if responseTime > 10 then -- è¶…è¿‡10ç§’è®¤ä¸ºæ˜¯å¼‚å¸¸
        warn("[ç½‘ç»œç›‘æ§] è¯·æ±‚å“åº”æ—¶é—´å¼‚å¸¸: " .. tostring(url) .. " - " .. string.format("%.2f", responseTime) .. "ç§’")
    end
    
    -- æ£€æµ‹ç©ºå“åº”æˆ–å¼‚å¸¸å“åº”
    if success and result then
        if #result == 0 then
            warn("[ç½‘ç»œç›‘æ§] ç©ºå“åº”: " .. url)
        elseif #result < 100 and string.find(result, "error") then
            warn("[ç½‘ç»œç›‘æ§] é”™è¯¯å“åº”: " .. url)
        end
    end
    
    return success and result or ""
end

-- å®šæœŸå®‰å…¨æŠ¥å‘Š
task.spawn(function()
    wait(300) -- æ¯5åˆ†é’Ÿç”Ÿæˆä¸€æ¬¡å®‰å…¨æŠ¥å‘Š
    
    while true do
        local blockedCount = AntiSpySystem.BlockedRequests
        local detectionCount = AntiSpySystem.DetectionCount
        
        if blockedCount > 0 or detectionCount > 0 then
            local report = string.format(
                "å®‰å…¨æŠ¥å‘Š: å·²é˜»æ­¢ %d ä¸ªè¯·æ±‚, æ£€æµ‹åˆ° %d æ¬¡å¨èƒ",
                blockedCount, detectionCount
            )
            
            warn("[å®‰å…¨æŠ¥å‘Š] " .. report)
            
            if WindUI and (blockedCount > 5 or detectionCount > 3) then
                WindUI:Notify({
                    Title = "å®‰å…¨æŠ¥å‘Š",
                    Content = report,
                    Duration = 10,
                    Color = Color3.fromRGB(255, 165, 0)
                })
            end
        end
        
        wait(300) -- ç­‰å¾…5åˆ†é’Ÿ
    end
end)

-- è¿æ¥çŠ¶æ€ç›‘æ§
local function monitorConnections()
    local NetworkClient = game:GetService("NetworkClient")
    if NetworkClient then
        -- ç›‘æ§è¿æ¥çŠ¶æ€å˜åŒ–
        -- æ³¨æ„ï¼šè¿™å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“çš„Robloxç‰ˆæœ¬è°ƒæ•´
    end
end

-- å¯åŠ¨è¿æ¥ç›‘æ§
task.spawn(monitorConnections)

-- å†…å­˜ä½¿ç”¨ç›‘æ§ï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
local function monitorMemoryUsage()
    local memoryWarningThreshold = 500 * 1024 * 1024 -- 500MB
    
    while true do
        local memoryUsage = collectgarbage("count") * 1024 -- è½¬æ¢ä¸ºå­—èŠ‚
        
        if memoryUsage > memoryWarningThreshold then
            warn("[å†…å­˜ç›‘æ§] å†…å­˜ä½¿ç”¨è¿‡é«˜: " .. string.format("%.2f", memoryUsage / 1024 / 1024) .. "MB")
            
            -- è§¦å‘åƒåœ¾å›æ”¶
            collectgarbage("collect")
            
            if WindUI then
                WindUI:Notify({
                    Title = "å†…å­˜è­¦å‘Š",
                    Content = "å†…å­˜ä½¿ç”¨è¿‡é«˜ï¼Œå·²è§¦å‘æ¸…ç†",
                    Duration = 5,
                    Color = Color3.fromRGB(255, 165, 0)
                })
            end
        end
        
        wait(30) -- æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡
    end
end

-- å¯åŠ¨å†…å­˜ç›‘æ§
task.spawn(monitorMemoryUsage)

-- è„šæœ¬å®Œæ•´æ€§æ£€æŸ¥
local function verifyScriptIntegrity()
    local criticalFunctions = {
        "safeLoadScript",
        "safeHttpGet", 
        "enhancedErrorHandler",
        "quickSecurityCheck"
    }
    
    for _, funcName in ipairs(criticalFunctions) do
        if not _G[funcName] and not getfenv()[funcName] then
            warn("[å®Œæ•´æ€§æ£€æŸ¥] å…³é”®å‡½æ•°ç¼ºå¤±: " .. funcName)
            return false
        end
    end
    
    return true
end

-- å®šæœŸå®Œæ•´æ€§æ£€æŸ¥
task.spawn(function()
    wait(60) -- ç­‰å¾…1åˆ†é’Ÿåå¼€å§‹æ£€æŸ¥
    
    while true do
        if not verifyScriptIntegrity() then
            warn("[å®Œæ•´æ€§æ£€æŸ¥] è„šæœ¬å®Œæ•´æ€§éªŒè¯å¤±è´¥")
            
            if WindUI then
                WindUI:Notify({
                    Title = "å®Œæ•´æ€§è­¦å‘Š",
                    Content = "æ£€æµ‹åˆ°è„šæœ¬æ–‡ä»¶å¯èƒ½è¢«ä¿®æ”¹",
                    Duration = 10,
                    Color = Color3.fromRGB(255, 0, 0)
                })
            end
        end
        
        wait(180) -- æ¯3åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    end
end)

-- æ€§èƒ½ç›‘æ§
local performanceStats = {
    requestCount = 0,
    errorCount = 0,
    startTime = os.time()
}

-- æ›´æ–°æ€§èƒ½ç»Ÿè®¡
local function updatePerformanceStats()
    local currentTime = os.time()
    local uptime = currentTime - performanceStats.startTime
    
    local statsMessage = string.format(
        "è¿è¡Œæ—¶é—´: %dç§’, è¯·æ±‚æ•°: %d, é”™è¯¯æ•°: %d",
        uptime, performanceStats.requestCount, performanceStats.errorCount
    )
    
    -- åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    if getgenv().DebugMode then
        warn("[æ€§èƒ½ç»Ÿè®¡] " .. statsMessage)
    end
end

-- æ€§èƒ½ç›‘æ§å¾ªç¯
task.spawn(function()
    while true do
        wait(120) -- æ¯2åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡
        updatePerformanceStats()
    end
end)

-- ç´§æ€¥æ¢å¤åŠŸèƒ½
local function emergencyRecovery()
    warn("[ç´§æ€¥æ¢å¤] å¯åŠ¨ç´§æ€¥æ¢å¤ç¨‹åº")
    
    -- åœæ­¢æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„å¾ªç¯
    for _, thread in pairs(coroutine.running() and {} or {}) do
        pcall(coroutine.close, thread)
    end
    
    -- æ¸…ç†å…¨å±€å˜é‡
    local protectedVars = {"WindUI", "Window", "Tabs", "LP"}
    for varName, varValue in pairs(getgenv() or {}) do
        if not table.find(protectedVars, varName) then
            getgenv()[varName] = nil
        end
    end
    
    -- å¼ºåˆ¶åƒåœ¾å›æ”¶
    for i = 1, 3 do
        wait(0.1)
        collectgarbage("collect")
    end
    
    -- é‡æ–°åˆå§‹åŒ–å…³é”®ç³»ç»Ÿ
    if WindUI then
        WindUI:Notify({
            Title = "ç³»ç»Ÿæ¢å¤",
            Content = "å·²å®Œæˆç´§æ€¥æ¢å¤æ“ä½œ",
            Duration = 5,
            Color = Color3.fromRGB(0, 255, 0)
        })
    end
end

-- åœ¨å·¥å…·é¡µé¢æ·»åŠ ç´§æ€¥æ¢å¤æŒ‰é’®
task.spawn(function()
    repeat wait(1) until Tabs and Tabs.Other
    
    Tabs.Other:Button({
        Title = "ç´§æ€¥æ¢å¤",
        Desc = "åœ¨ç³»ç»Ÿå¼‚å¸¸æ—¶ä½¿ç”¨",
        Callback = function()
            emergencyRecovery()
        end
    })
end)

-- è‡ªåŠ¨é”™è¯¯æŠ¥å‘Šæ”¹è¿›
local errorReports = {}
local function submitErrorReport(errorMsg, context)
    local report = {
        timestamp = os.time(),
        error = tostring(errorMsg),
        context = context,
        gameId = game.PlaceId,
        player = game.Players.LocalPlayer and game.Players.LocalPlayer.Name or "Unknown"
    }
    
    table.insert(errorReports, report)
    
    -- é™åˆ¶æŠ¥å‘Šæ•°é‡
    if #errorReports > 20 then
        table.remove(errorReports, 1)
    end
    
    -- åœ¨è°ƒè¯•æ¨¡å¼ä¸‹è¾“å‡ºé”™è¯¯æŠ¥å‘Š
    if getgenv().DebugMode then
        warn("[é”™è¯¯æŠ¥å‘Š] " .. errorMsg .. " | Context: " .. tostring(context))
    end
end

-- å¢å¼ºé”™è¯¯å¤„ç†
local originalEnhancedErrorHandler = enhancedErrorHandler
enhancedErrorHandler = function(err)
    submitErrorReport(err, "enhancedErrorHandler")
    return originalEnhancedErrorHandler(err)
end

-- ç½‘ç»œè¯·æ±‚ç»Ÿè®¡
local function getRequestStatistics()
    local totalRequests = performanceStats.requestCount
    local successRate = totalRequests > 0 and 
        ((totalRequests - performanceStats.errorCount) / totalRequests * 100) or 100
    
    return {
        totalRequests = totalRequests,
        errorCount = performanceStats.errorCount,
        successRate = successRate,
        blockedRequests = AntiSpySystem.BlockedRequests,
        threatDetections = AntiSpySystem.DetectionCount
    }
end

-- åœ¨å·¥å…·é¡µé¢æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
task.spawn(function()
    repeat wait(1) until Tabs and Tabs.Other
    
    Tabs.Other:Section({Title = "ç³»ç»Ÿç»Ÿè®¡"})
    
    Tabs.Other:Button({
        Title = "æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯",
        Desc = "æŸ¥çœ‹ç³»ç»Ÿè¿è¡Œç»Ÿè®¡",
        Callback = function()
            local stats = getRequestStatistics()
            local message = string.format(
                "æ€»è¯·æ±‚: %d\né”™è¯¯æ•°: %d\næˆåŠŸç‡: %.1f%%\né˜»æ­¢è¯·æ±‚: %d\nå¨èƒæ£€æµ‹: %d",
                stats.totalRequests, stats.errorCount, stats.successRate,
                stats.blockedRequests, stats.threatDetections
            )
            
            if WindUI then
                WindUI:Notify({
                    Title = "ç³»ç»Ÿç»Ÿè®¡",
                    Content = message,
                    Duration = 10,
                    Color = Color3.fromRGB(0, 170, 255)
                })
            end
        end
    })
end)

-- å¯åŠ¨å®Œæˆæ¶ˆæ¯
task.spawn(function()
    wait(5) -- ç­‰å¾…5ç§’ç¡®ä¿æ‰€æœ‰ç³»ç»Ÿå°±ç»ª
    
    local startupMessage = [[
âœ… æœ¬ç†Šè„šæœ¬ v1.7.4 å¯åŠ¨å®Œæˆ
ğŸ”’ åæŠ“åŒ…ä¿æŠ¤ç³»ç»Ÿå·²æ¿€æ´»
ğŸ›¡ï¸ å®‰å…¨ç›‘æ§è¿è¡Œä¸­
ğŸ“Š æ€§èƒ½ç›‘æ§å·²å¯ç”¨
    ]]
    
    warn(startupMessage)
    
    if WindUI then
        WindUI:Notify({
            Title = "ç³»ç»Ÿå°±ç»ª",
            Content = "æ‰€æœ‰ä¿æŠ¤ç³»ç»Ÿå·²æ¿€æ´»\nè„šæœ¬æ­£å¸¸è¿è¡Œä¸­",
            Duration = 6,
            Color = Color3.fromRGB(0, 255, 0)
        })
    end
end)

-- æœ€ç»ˆæ¸…ç†å’Œä¼˜åŒ–
task.spawn(function()
    wait(10) -- ç­‰å¾…10ç§’åæ‰§è¡Œæ¸…ç†
    
    -- æ¸…ç†ä¸´æ—¶å˜é‡
    local tempVars = {"startupMessage", "tempVars", "originalFunctions"}
    for _, varName in ipairs(tempVars) do
        _G[varName] = nil
    end
    
    -- è§¦å‘ä¸€æ¬¡åƒåœ¾å›æ”¶
    collectgarbage("collect")
    
    warn("[ç³»ç»Ÿä¼˜åŒ–] å¯åŠ¨åæ¸…ç†å®Œæˆ")
end)

-- å¯¼å‡ºå…¨å±€å‡½æ•°ï¼ˆç”¨äºè°ƒè¯•ï¼‰
if getgenv() then
    getgenv().GetAntiSpyStatus = function()
        return {
            enabled = AntiSpySystem.Enabled,
            blockedRequests = AntiSpySystem.BlockedRequests,
            detections = AntiSpySystem.DetectionCount
        }
    end
    
    getgenv().GetPerformanceStats = getRequestStatistics
    getgenv().EmergencyRecovery = emergencyRecovery
end

-- è„šæœ¬ç»“æŸæ ‡è®°
warn("æœ¬ç†Šè„šæœ¬åŠ è½½å®Œæˆ - æ‰€æœ‰ç³»ç»Ÿå°±ç»ª")
